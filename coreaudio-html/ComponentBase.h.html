<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>
<i><font color="#9A1900">/*   Path: ~/lab/CoreAudioUtilityClasses/Mac/CoreAudioUtilityClasses/CoreAudio/AudioUnits/AUPublic/AUBase/ComponentBase.h  */</font></i>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">     File: ComponentBase.h </font></i>
<i><font color="#9A1900"> Abstract:  Part of CoreAudio Utility Classes  </font></i>
<i><font color="#9A1900">  Version: 1.0.4 </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple </font></i>
<i><font color="#9A1900"> Inc. ("Apple") in consideration of your agreement to the following </font></i>
<i><font color="#9A1900"> terms, and your use, installation, modification or redistribution of </font></i>
<i><font color="#9A1900"> this Apple software constitutes acceptance of these terms.  If you do </font></i>
<i><font color="#9A1900"> not agree with these terms, please do not use, install, modify or </font></i>
<i><font color="#9A1900"> redistribute this Apple software. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> In consideration of your agreement to abide by the following terms, and </font></i>
<i><font color="#9A1900"> subject to these terms, Apple grants you a personal, non-exclusive </font></i>
<i><font color="#9A1900"> license, under Apple's copyrights in this original Apple software (the </font></i>
<i><font color="#9A1900"> "Apple Software"), to use, reproduce, modify and redistribute the Apple </font></i>
<i><font color="#9A1900"> Software, with or without modifications, in source and/or binary forms; </font></i>
<i><font color="#9A1900"> provided that if you redistribute the Apple Software in its entirety and </font></i>
<i><font color="#9A1900"> without modifications, you must retain this notice and the following </font></i>
<i><font color="#9A1900"> text and disclaimers in all such redistributions of the Apple Software. </font></i>
<i><font color="#9A1900"> Neither the name, trademarks, service marks or logos of Apple Inc. may </font></i>
<i><font color="#9A1900"> be used to endorse or promote products derived from the Apple Software </font></i>
<i><font color="#9A1900"> without specific prior written permission from Apple.  Except as </font></i>
<i><font color="#9A1900"> expressly stated in this notice, no other rights or licenses, express or </font></i>
<i><font color="#9A1900"> implied, are granted by Apple herein, including but not limited to any </font></i>
<i><font color="#9A1900"> patent rights that may be infringed by your derivative works or by other </font></i>
<i><font color="#9A1900"> works in which the Apple Software may be incorporated. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> The Apple Software is provided by Apple on an "AS IS" basis.  APPLE </font></i>
<i><font color="#9A1900"> MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION </font></i>
<i><font color="#9A1900"> THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS </font></i>
<i><font color="#9A1900"> FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND </font></i>
<i><font color="#9A1900"> OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL </font></i>
<i><font color="#9A1900"> OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF </font></i>
<i><font color="#9A1900"> SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS </font></i>
<i><font color="#9A1900"> INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, </font></i>
<i><font color="#9A1900"> MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED </font></i>
<i><font color="#9A1900"> AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE), </font></i>
<i><font color="#9A1900"> STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE </font></i>
<i><font color="#9A1900"> POSSIBILITY OF SUCH DAMAGE. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> Copyright (C) 2013 Apple Inc. All Rights Reserved. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900">*/</font></i>
<b><font color="#000080">#ifndef</font></b> __ComponentBase_h__
<b><font color="#000080">#define</font></b> __ComponentBase_h__

<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;new&gt;</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CADebugMacros.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CAXException.h"</font>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font><b><font color="#000000">defined</font></b><font color="#990000">(</font>__COREAUDIO_USE_FLAT_INCLUDES__<font color="#990000">)</font>
<b><font color="#000080">	#include</font></b> <font color="#FF0000">&lt;CoreAudio/CoreAudioTypes.h&gt;</font>
<b><font color="#000080">	#include</font></b> <font color="#FF0000">&lt;AudioUnit/AudioUnit.h&gt;</font>

<b><font color="#000080">	#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">		#include</font></b> <font color="#FF0000">&lt;CoreServices/../Frameworks/CarbonCore.framework/Headers/Components.h&gt;</font>
	
<b><font color="#000080">		#if</font></b>	<font color="#990000">(</font>MAC_OS_X_VERSION_MAX_ALLOWED <font color="#990000">&lt;=</font> MAC_OS_X_VERSION_10_5<font color="#990000">)</font>
<b><font color="#000080">			#define</font></b> AudioComponentInstance			ComponentInstance
<b><font color="#000080">			#define</font></b> AudioComponentDescription		ComponentDescription
<b><font color="#000080">			#define</font></b>	AudioComponent					Component
<b><font color="#000080">		#endif</font></b>
		<font color="#008080">Handle</font> <b><font color="#000000">CMgr_GetComponentInstanceStorage</font></b><font color="#990000">(</font><font color="#008080">ComponentInstance</font> aComponentInstance<font color="#990000">);</font>
		<font color="#009900">void</font> <b><font color="#000000">CMgr_SetComponentInstanceStorage</font></b><font color="#990000">(</font><font color="#008080">ComponentInstance</font> aComponentInstance<font color="#990000">,</font> <font color="#008080">Handle</font> theStorage<font color="#990000">);</font>
<b><font color="#000080">	#endif</font></b>

<b><font color="#000080">	#if</font></b> MAC_OS_X_VERSION_MAX_ALLOWED <font color="#990000">&lt;=</font> MAC_OS_X_VERSION_10_4
		<b><font color="#0000FF">typedef</font></b> <font color="#008080">Float32</font> AudioUnitParameterValue<font color="#990000">;</font>
<b><font color="#000080">	#endif</font></b>
<b><font color="#000080">	#if</font></b> COREAUDIOTYPES_VERSION <font color="#990000">&lt;</font> <font color="#993399">1051</font>
		<b><font color="#0000FF">typedef</font></b> <font color="#008080">Float32</font> AudioUnitSampleType<font color="#990000">;</font>
<b><font color="#000080">	#endif</font></b>

<b><font color="#000080">	#if</font></b> <font color="#990000">!</font>TARGET_OS_WIN32
<b><font color="#000080">		#include</font></b> <font color="#FF0000">&lt;pthread.h&gt;</font>
<b><font color="#000080">	#endif</font></b>

<b><font color="#000080">	#if</font></b> TARGET_OS_WIN32
<b><font color="#000080">		#include</font></b> <font color="#FF0000">"CAGuard.h"</font>
<b><font color="#000080">	#endif</font></b>
<b><font color="#000080">#else</font></b>
<b><font color="#000080">	#include</font></b> <font color="#FF0000">"CoreAudioTypes.h"</font>
<b><font color="#000080">	#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">		#include</font></b> <font color="#FF0000">"ComponentManagerDependenciesWin.h"</font>
<b><font color="#000080">	#endif</font></b>
<b><font color="#000080">	#include</font></b> <font color="#FF0000">"AudioUnit.h"</font>
<b><font color="#000080">	#include</font></b> <font color="#FF0000">"CAGuard.h"</font>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#ifndef</font></b> COMPONENT_THROW
<b><font color="#000080">	#if</font></b> VERBOSE_COMPONENT_THROW
<b><font color="#000080">		#define</font></b> <b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>throw_err<font color="#990000">)</font> <font color="#990000">\</font>
			<b><font color="#0000FF">do</font></b> <font color="#FF0000">{</font> <b><font color="#000000">DebugMessage</font></b><font color="#990000">(</font>#throw_err<font color="#990000">);</font> <b><font color="#0000FF">throw</font></b> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>OSStatus<font color="#990000">&gt;(</font>throw_err<font color="#990000">);</font> <font color="#FF0000">}</font> <b><font color="#0000FF">while</font></b> <font color="#990000">(</font><font color="#993399">0</font><font color="#990000">)</font>
<b><font color="#000080">	#else</font></b>
<b><font color="#000080">		#define</font></b> <b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>throw_err<font color="#990000">)</font> <font color="#990000">\</font>
			<b><font color="#0000FF">throw</font></b> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>OSStatus<font color="#990000">&gt;(</font>throw_err<font color="#990000">)</font>
<b><font color="#000080">	#endif</font></b>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#define</font></b> COMPONENT_CATCH <font color="#990000">\</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">CAXException</font> <font color="#990000">&amp;</font>ex<font color="#990000">)</font> <font color="#FF0000">{</font> result <font color="#990000">=</font> ex<font color="#990000">.</font>mError<font color="#990000">;</font> <font color="#FF0000">}</font> <font color="#990000">\</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font>std<font color="#990000">::</font>bad_alloc <font color="#990000">&amp;)</font> <font color="#FF0000">{</font> result <font color="#990000">=</font> kAudio_MemFullError<font color="#990000">;</font> <font color="#FF0000">}</font> <font color="#990000">\</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><font color="#008080">OSStatus</font> catch_err<font color="#990000">)</font> <font color="#FF0000">{</font> result <font color="#990000">=</font> catch_err<font color="#990000">;</font> <font color="#FF0000">}</font> <font color="#990000">\</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><font color="#008080">OSErr</font> catch_err<font color="#990000">)</font> <font color="#FF0000">{</font> result <font color="#990000">=</font> catch_err<font color="#990000">;</font> <font color="#FF0000">}</font> <font color="#990000">\</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(...)</font> <font color="#FF0000">{</font> result <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font> <font color="#FF0000">}</font>

<i><font color="#9A1900">/*! @class ComponentBase */</font></i>
<b><font color="#0000FF">class</font></b> <font color="#008080">ComponentBase</font> <font color="#FF0000">{</font>
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<i><font color="#9A1900">// classic MacErrors</font></i>
	<b><font color="#0000FF">enum</font></b> <font color="#FF0000">{</font> noErr <font color="#990000">=</font> <font color="#993399">0</font><font color="#FF0000">}</font><font color="#990000">;</font>

	<i><font color="#9A1900">/*! @ctor ComponentBase */</font></i>
				<b><font color="#000000">ComponentBase</font></b><font color="#990000">(</font><font color="#008080">AudioComponentInstance</font> inInstance<font color="#990000">);</font>
				
	<i><font color="#9A1900">/*! @dtor ~ComponentBase */</font></i>
	<b><font color="#0000FF">virtual</font></b> 	<font color="#990000">~</font><b><font color="#000000">ComponentBase</font></b><font color="#990000">();</font>
	
	<i><font color="#9A1900">/*! @method PostConstructor */</font></i>
	<b><font color="#0000FF">virtual</font></b> <font color="#009900">void</font>			<b><font color="#000000">PostConstructor</font></b><font color="#990000">();</font>
	
	<i><font color="#9A1900">/*! @method PreDestructor */</font></i>
	<b><font color="#0000FF">virtual</font></b> <font color="#009900">void</font>			<b><font color="#000000">PreDestructor</font></b><font color="#990000">();</font>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
	<i><font color="#9A1900">/*! @method Version */</font></i>
	<b><font color="#0000FF">virtual</font></b> <font color="#008080">OSStatus</font>		<b><font color="#000000">Version</font></b><font color="#990000">();</font>

	<i><font color="#9A1900">/*! @method ComponentEntryDispatch */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">OSStatus</font>		<b><font color="#000000">ComponentEntryDispatch</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>p<font color="#990000">,</font> <font color="#008080">ComponentBase</font> <font color="#990000">*</font>This<font color="#990000">);</font>

	<i><font color="#9A1900">/*! GetSelectorForCanDo */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">SInt16</font>		<b><font color="#000000">GetSelectorForCanDo</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">);</font>
<b><font color="#000080">#endif</font></b>
	
	<i><font color="#9A1900">/*! @method GetComponentInstance */</font></i>
	<font color="#008080">AudioComponentInstance</font>		<b><font color="#000000">GetComponentInstance</font></b><font color="#990000">()</font> <b><font color="#0000FF">const</font></b> <font color="#FF0000">{</font> <b><font color="#0000FF">return</font></b> mComponentInstance<font color="#990000">;</font> <font color="#FF0000">}</font>

	<i><font color="#9A1900">/*! @method GetComponentDescription */</font></i>
	<font color="#008080">AudioComponentDescription</font>	<b><font color="#000000">GetComponentDescription</font></b><font color="#990000">()</font> <b><font color="#0000FF">const</font></b><font color="#990000">;</font>

	<i><font color="#9A1900">// This global variable is so that new instances know how they were instantiated: via the Component Manager, </font></i>
	<i><font color="#9A1900">// or as AudioComponents. It's ugly, but preferable to altering the constructor of every class in the hierarchy.</font></i>
	<i><font color="#9A1900">// It's safe because construction is protected by ComponentInitLocker.</font></i>
	<b><font color="#0000FF">enum</font></b> EInstanceType <font color="#FF0000">{</font> kComponentMgrInstance<font color="#990000">,</font> kAudioComponentInstance <font color="#FF0000">}</font><font color="#990000">;</font>
	<b><font color="#0000FF">static</font></b> <font color="#008080">EInstanceType</font> sNewInstanceType<font color="#990000">;</font>

	<i><font color="#9A1900">/*! @method IsPluginObject */</font></i>
	<font color="#009900">bool</font>			<b><font color="#000000">IsPluginObject</font></b> <font color="#990000">()</font> <b><font color="#0000FF">const</font></b> <font color="#FF0000">{</font> <b><font color="#0000FF">return</font></b> mInstanceType <font color="#990000">==</font> kAudioComponentInstance<font color="#990000">;</font> <font color="#FF0000">}</font>
	<i><font color="#9A1900">/*! @method IsCMgrObject */</font></i>
	<font color="#009900">bool</font>			<b><font color="#000000">IsCMgrObject</font></b> <font color="#990000">()</font> <b><font color="#0000FF">const</font></b> <font color="#FF0000">{</font> <b><font color="#0000FF">return</font></b> mInstanceType <font color="#990000">==</font> kComponentMgrInstance<font color="#990000">;</font> <font color="#FF0000">}</font>

	<i><font color="#9A1900">/*! @method AP_Open */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">OSStatus</font> <b><font color="#000000">AP_Open</font></b><font color="#990000">(</font><font color="#009900">void</font> <font color="#990000">*</font>self<font color="#990000">,</font> <font color="#008080">AudioUnit</font> compInstance<font color="#990000">);</font>

	<i><font color="#9A1900">/*! @method AP_Close */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">OSStatus</font> <b><font color="#000000">AP_Close</font></b><font color="#990000">(</font><font color="#009900">void</font> <font color="#990000">*</font>self<font color="#990000">);</font>
	
<b><font color="#0000FF">protected</font></b><font color="#990000">:</font>
	<i><font color="#9A1900">/*! @var mComponentInstance */</font></i>
	<font color="#008080">AudioComponentInstance</font>		mComponentInstance<font color="#990000">;</font>
	<font color="#008080">EInstanceType</font>				mInstanceType<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#0000FF">class</font></b> <font color="#008080">ComponentInitLocker</font> 
<font color="#FF0000">{</font>
<b><font color="#000080">#if</font></b> TARGET_OS_MAC
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<b><font color="#000000">ComponentInitLocker</font></b><font color="#990000">()</font> 
	<font color="#FF0000">{</font> 
		<b><font color="#000000">pthread_once</font></b><font color="#990000">(&amp;</font>sOnce<font color="#990000">,</font> InitComponentInitLocker<font color="#990000">);</font>
		<b><font color="#000000">pthread_mutex_lock</font></b><font color="#990000">(&amp;</font>sComponentOpenMutex<font color="#990000">);</font> 
		mPreviousNewInstanceType <font color="#990000">=</font> ComponentBase<font color="#990000">::</font>sNewInstanceType<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<font color="#990000">~</font><b><font color="#000000">ComponentInitLocker</font></b><font color="#990000">()</font> 
	<font color="#FF0000">{</font> 
		ComponentBase<font color="#990000">::</font>sNewInstanceType <font color="#990000">=</font> mPreviousNewInstanceType<font color="#990000">;</font>
		<b><font color="#000000">pthread_mutex_unlock</font></b><font color="#990000">(&amp;</font>sComponentOpenMutex<font color="#990000">);</font> 
	<font color="#FF0000">}</font>
<b><font color="#0000FF">private</font></b><font color="#990000">:</font>
	<b><font color="#0000FF">static</font></b> <font color="#008080">pthread_mutex_t</font> sComponentOpenMutex<font color="#990000">;</font>
	<b><font color="#0000FF">static</font></b> <font color="#008080">pthread_once_t</font> sOnce<font color="#990000">;</font>
	<b><font color="#0000FF">static</font></b> <font color="#009900">void</font> <b><font color="#000000">InitComponentInitLocker</font></b><font color="#990000">();</font>
	
<b><font color="#000080">#elif</font></b> TARGET_OS_WIN32
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<font color="#009900">bool</font> sNeedsUnlocking<font color="#990000">;</font>
	<b><font color="#000000">ComponentInitLocker</font></b><font color="#990000">()</font> <font color="#FF0000">{</font> sNeedsUnlocking <font color="#990000">=</font> sComponentOpenGuard<font color="#990000">.</font><b><font color="#000000">Lock</font></b><font color="#990000">();</font> <font color="#FF0000">}</font>
	<font color="#990000">~</font><b><font color="#000000">ComponentInitLocker</font></b><font color="#990000">()</font> <font color="#FF0000">{</font> <b><font color="#0000FF">if</font></b><font color="#990000">(</font>sNeedsUnlocking<font color="#990000">)</font> <font color="#FF0000">{</font> sComponentOpenGuard<font color="#990000">.</font><b><font color="#000000">Unlock</font></b><font color="#990000">();</font> <font color="#FF0000">}</font> <font color="#FF0000">}</font>
<b><font color="#0000FF">private</font></b><font color="#990000">:</font>
	<b><font color="#0000FF">static</font></b> <font color="#008080">CAGuard</font>	sComponentOpenGuard<font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
	
<b><font color="#0000FF">private</font></b><font color="#990000">:</font>
	ComponentBase<font color="#990000">::</font><font color="#008080">EInstanceType</font>	mPreviousNewInstanceType<font color="#990000">;</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">/*! @class AudioComponentPlugInInstance */</font></i> 
<b><font color="#0000FF">struct</font></b> <font color="#008080">AudioComponentPlugInInstance</font> <font color="#FF0000">{</font>
	<font color="#008080">AudioComponentPlugInInterface</font>		mPlugInInterface<font color="#990000">;</font>
	<font color="#009900">void</font> <font color="#990000">*</font>								<font color="#990000">(*</font>mConstruct<font color="#990000">)(</font><font color="#009900">void</font> <font color="#990000">*</font>memory<font color="#990000">,</font> <font color="#008080">AudioComponentInstance</font> ci<font color="#990000">);</font>
	<font color="#009900">void</font>								<font color="#990000">(*</font>mDestruct<font color="#990000">)(</font><font color="#009900">void</font> <font color="#990000">*</font>memory<font color="#990000">);</font>
	<font color="#009900">void</font> <font color="#990000">*</font>								mPad<font color="#990000">[</font><font color="#993399">2</font><font color="#990000">];</font>				<i><font color="#9A1900">// pad to a 16-byte boundary (in either 32 or 64 bit mode)</font></i>
	<font color="#008080">UInt32</font>								mInstanceStorage<font color="#990000">;</font>		<i><font color="#9A1900">// the ACI implementation object is constructed into this memory</font></i>
																<i><font color="#9A1900">// this member is just a placeholder. it is aligned to a 16byte boundary</font></i>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">/*! @class APFactory */</font></i> 
<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">class</font></b> <font color="#008080">APMethodLookup</font><font color="#990000">,</font> <b><font color="#0000FF">class</font></b> <font color="#008080">Implementor</font><font color="#990000">&gt;</font>
<b><font color="#0000FF">class</font></b> <font color="#008080">APFactory</font> <font color="#FF0000">{</font>
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<b><font color="#0000FF">static</font></b> <font color="#009900">void</font> <font color="#990000">*</font><b><font color="#000000">Construct</font></b><font color="#990000">(</font><font color="#009900">void</font> <font color="#990000">*</font>memory<font color="#990000">,</font> <font color="#008080">AudioComponentInstance</font> compInstance<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b><font color="#990000">(</font>memory<font color="#990000">)</font> <b><font color="#000000">Implementor</font></b><font color="#990000">(</font>compInstance<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">static</font></b> <font color="#009900">void</font> <b><font color="#000000">Destruct</font></b><font color="#990000">(</font><font color="#009900">void</font> <font color="#990000">*</font>memory<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<font color="#990000">((</font>Implementor <font color="#990000">*)</font>memory<font color="#990000">)-&gt;~</font><b><font color="#000000">Implementor</font></b><font color="#990000">();</font>
	<font color="#FF0000">}</font>

	<i><font color="#9A1900">// This is the AudioComponentFactoryFunction. It returns an AudioComponentPlugInInstance.</font></i>
	<i><font color="#9A1900">// The actual implementation object is not created until Open().</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">AudioComponentPlugInInterface</font> <font color="#990000">*</font><b><font color="#000000">Factory</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioComponentDescription</font> <font color="#990000">*</font>inDesc<font color="#990000">)</font> 
	<font color="#FF0000">{</font>
		<font color="#008080">AudioComponentPlugInInstance</font> <font color="#990000">*</font>acpi <font color="#990000">=</font> 
				<font color="#990000">(</font>AudioComponentPlugInInstance <font color="#990000">*)</font><b><font color="#000000">malloc</font></b><font color="#990000">(</font> <b><font color="#000000">offsetof</font></b><font color="#990000">(</font>AudioComponentPlugInInstance<font color="#990000">,</font> mInstanceStorage<font color="#990000">)</font> <font color="#990000">+</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Implementor<font color="#990000">)</font> <font color="#990000">);</font>
		acpi<font color="#990000">-&gt;</font>mPlugInInterface<font color="#990000">.</font>Open <font color="#990000">=</font> ComponentBase<font color="#990000">::</font>AP_Open<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mPlugInInterface<font color="#990000">.</font>Close <font color="#990000">=</font> ComponentBase<font color="#990000">::</font>AP_Close<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mPlugInInterface<font color="#990000">.</font>Lookup <font color="#990000">=</font> APMethodLookup<font color="#990000">::</font>Lookup<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mPlugInInterface<font color="#990000">.</font>reserved <font color="#990000">=</font> NULL<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mConstruct <font color="#990000">=</font> Construct<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mDestruct <font color="#990000">=</font> Destruct<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mPad<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]</font> <font color="#990000">=</font> NULL<font color="#990000">;</font>
		acpi<font color="#990000">-&gt;</font>mPad<font color="#990000">[</font><font color="#993399">1</font><font color="#990000">]</font> <font color="#990000">=</font> NULL<font color="#990000">;</font>
		<b><font color="#0000FF">return</font></b> <font color="#990000">(</font>AudioComponentPlugInInterface<font color="#990000">*)</font>acpi<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
	<i><font color="#9A1900">// This is for runtime registration (not for plug-ins loaded from bundles).</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">AudioComponent</font> <b><font color="#000000">Register</font></b><font color="#990000">(</font><font color="#008080">UInt32</font> type<font color="#990000">,</font> <font color="#008080">UInt32</font> subtype<font color="#990000">,</font> <font color="#008080">UInt32</font> manuf<font color="#990000">,</font> <font color="#008080">CFStringRef</font> name<font color="#990000">,</font> <font color="#008080">UInt32</font> vers<font color="#990000">,</font> <font color="#008080">UInt32</font> flags<font color="#990000">=</font><font color="#993399">0</font><font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<font color="#008080">AudioComponentDescription</font> desc <font color="#990000">=</font> <font color="#FF0000">{</font> type<font color="#990000">,</font> subtype<font color="#990000">,</font> manuf<font color="#990000">,</font> flags<font color="#990000">,</font> <font color="#993399">0</font> <font color="#FF0000">}</font><font color="#990000">;</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#000000">AudioComponentRegister</font></b><font color="#990000">(&amp;</font>desc<font color="#990000">,</font> name<font color="#990000">,</font> vers<font color="#990000">,</font> Factory<font color="#990000">);</font> 
	<font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<i><font color="#9A1900">/*! @class ComponentEntryPoint </font></i>
<i><font color="#9A1900"> *	@discussion This is only used for a component manager version</font></i>
<i><font color="#9A1900">*/</font></i>
<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">class</font></b> <font color="#008080">Class</font><font color="#990000">&gt;</font>
<b><font color="#0000FF">class</font></b> <font color="#008080">ComponentEntryPoint</font> <font color="#FF0000">{</font>
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<i><font color="#9A1900">/*! @method Dispatch */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">OSStatus</font> <b><font color="#000000">Dispatch</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">,</font> <font color="#008080">Class</font> <font color="#990000">*</font>obj<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		
		<b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>params<font color="#990000">-&gt;</font>what <font color="#990000">==</font> kComponentOpenSelect<font color="#990000">)</font> <font color="#FF0000">{</font>
				<i><font color="#9A1900">// solve a host of initialization thread safety issues.</font></i>
				<font color="#008080">ComponentInitLocker</font> lock<font color="#990000">;</font>

				ComponentBase<font color="#990000">::</font>sNewInstanceType <font color="#990000">=</font> ComponentBase<font color="#990000">::</font>kComponentMgrInstance<font color="#990000">;</font>
				<font color="#008080">ComponentInstance</font> ci <font color="#990000">=</font> <font color="#990000">(</font>ComponentInstance<font color="#990000">)(</font>params<font color="#990000">-&gt;</font>params<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">]);</font>
				<font color="#008080">Class</font> <font color="#990000">*</font>This <font color="#990000">=</font> <b><font color="#0000FF">new</font></b> <b><font color="#000000">Class</font></b><font color="#990000">((</font>AudioComponentInstance<font color="#990000">)</font>ci<font color="#990000">);</font>
				This<font color="#990000">-&gt;</font><b><font color="#000000">PostConstructor</font></b><font color="#990000">();</font>	<i><font color="#9A1900">// allows base class to do additional initialization</font></i>
											<i><font color="#9A1900">// once the derived class is fully constructed</font></i>
				
				<b><font color="#000000">CMgr_SetComponentInstanceStorage</font></b><font color="#990000">(</font>ci<font color="#990000">,</font> <font color="#990000">(</font>Handle<font color="#990000">)</font>This<font color="#990000">);</font>
			<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
				result <font color="#990000">=</font> Class<font color="#990000">::</font><b><font color="#000000">ComponentEntryDispatch</font></b><font color="#990000">(</font>params<font color="#990000">,</font> obj<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		COMPONENT_CATCH
		
		<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
	<i><font color="#9A1900">/*! @method Register */</font></i>
	<b><font color="#0000FF">static</font></b> <font color="#008080">Component</font> <b><font color="#000000">Register</font></b><font color="#990000">(</font><font color="#008080">OSType</font> compType<font color="#990000">,</font> <font color="#008080">OSType</font> subType<font color="#990000">,</font> <font color="#008080">OSType</font> manufacturer<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<font color="#008080">ComponentDescription</font>	description <font color="#990000">=</font> <font color="#FF0000">{</font>compType<font color="#990000">,</font> subType<font color="#990000">,</font> manufacturer<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#FF0000">}</font><font color="#990000">;</font>
		<font color="#008080">Component</font>	component <font color="#990000">=</font> <b><font color="#000000">RegisterComponent</font></b><font color="#990000">(&amp;</font>description<font color="#990000">,</font> <font color="#990000">(</font>ComponentRoutineUPP<font color="#990000">)</font> Dispatch<font color="#990000">,</font> registerComponentGlobal<font color="#990000">,</font> NULL<font color="#990000">,</font> NULL<font color="#990000">,</font> NULL<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>component <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">SetDefaultComponent</font></b><font color="#990000">(</font>component<font color="#990000">,</font> defaultComponentAnyFlagsAnyManufacturerAnySubType<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">return</font></b> component<font color="#990000">;</font>
	<font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<i><font color="#9A1900">// NOTE: Component Mgr is deprecated in ML.</font></i>
<i><font color="#9A1900">// this macro should not be used with new audio components</font></i>
<i><font color="#9A1900">// it is only for backwards compatibility with Lion and SL.</font></i>
<i><font color="#9A1900">// this macro registers both a plugin and a component mgr version.</font></i>
<b><font color="#000080">#define</font></b> <b><font color="#000000">AUDIOCOMPONENT_ENTRY</font></b><font color="#990000">(</font>FactoryType<font color="#990000">,</font> Class<font color="#990000">)</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#008080">OSStatus</font> Class##<b><font color="#000000">Entry</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">,</font> <font color="#008080">Class</font> <font color="#990000">*</font>obj<font color="#990000">);</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#008080">OSStatus</font> Class##<b><font color="#000000">Entry</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">,</font> <font color="#008080">Class</font> <font color="#990000">*</font>obj<font color="#990000">)</font> <font color="#FF0000">{</font> <font color="#990000">\</font>
        <b><font color="#0000FF">return</font></b> ComponentEntryPoint<font color="#990000">&lt;</font>Class<font color="#990000">&gt;::</font><b><font color="#000000">Dispatch</font></b><font color="#990000">(</font>params<font color="#990000">,</font> obj<font color="#990000">);</font> <font color="#990000">\</font>
    <font color="#FF0000">}</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#009900">void</font> <font color="#990000">*</font> Class##<b><font color="#000000">Factory</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioComponentDescription</font> <font color="#990000">*</font>inDesc<font color="#990000">);</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#009900">void</font> <font color="#990000">*</font> Class##<b><font color="#000000">Factory</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioComponentDescription</font> <font color="#990000">*</font>inDesc<font color="#990000">)</font> <font color="#FF0000">{</font> <font color="#990000">\</font>
        <b><font color="#0000FF">return</font></b> FactoryType<font color="#990000">&lt;</font>Class<font color="#990000">&gt;::</font><b><font color="#000000">Factory</font></b><font color="#990000">(</font>inDesc<font color="#990000">);</font> <font color="#990000">\</font>
    <font color="#FF0000">}</font>
    <i><font color="#9A1900">// the only component we still support are the carbon based view components</font></i>
    <i><font color="#9A1900">// you should be using this macro now to exclusively register those types</font></i>
<b><font color="#000080">#define</font></b> <b><font color="#000000">VIEW_COMPONENT_ENTRY</font></b><font color="#990000">(</font>Class<font color="#990000">)</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#008080">OSStatus</font> Class##<b><font color="#000000">Entry</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">,</font> <font color="#008080">Class</font> <font color="#990000">*</font>obj<font color="#990000">);</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#008080">OSStatus</font> Class##<b><font color="#000000">Entry</font></b><font color="#990000">(</font><font color="#008080">ComponentParameters</font> <font color="#990000">*</font>params<font color="#990000">,</font> <font color="#008080">Class</font> <font color="#990000">*</font>obj<font color="#990000">)</font> <font color="#FF0000">{</font> <font color="#990000">\</font>
        <b><font color="#0000FF">return</font></b> ComponentEntryPoint<font color="#990000">&lt;</font>Class<font color="#990000">&gt;::</font><b><font color="#000000">Dispatch</font></b><font color="#990000">(</font>params<font color="#990000">,</font> obj<font color="#990000">);</font> <font color="#990000">\</font>
    <font color="#FF0000">}</font>

	<i><font color="#9A1900">/*! @class ComponentRegistrar */</font></i>
<b><font color="#0000FF">template</font></b> <font color="#990000">&lt;</font><b><font color="#0000FF">class</font></b> <font color="#008080">Class</font><font color="#990000">,</font> <font color="#008080">OSType</font> Type<font color="#990000">,</font> <font color="#008080">OSType</font> Subtype<font color="#990000">,</font> <font color="#008080">OSType</font> Manufacturer<font color="#990000">&gt;</font>
<b><font color="#0000FF">class</font></b> <font color="#008080">ComponentRegistrar</font> <font color="#FF0000">{</font>
<b><font color="#0000FF">public</font></b><font color="#990000">:</font>
	<i><font color="#9A1900">/*! @ctor ComponentRegistrar */</font></i>
	<b><font color="#000000">ComponentRegistrar</font></b><font color="#990000">()</font> <font color="#FF0000">{</font> ComponentEntryPoint<font color="#990000">&lt;</font>Class<font color="#990000">&gt;::</font><b><font color="#000000">Register</font></b><font color="#990000">(</font>Type<font color="#990000">,</font> Subtype<font color="#990000">,</font> Manufacturer<font color="#990000">);</font> <font color="#FF0000">}</font>
<font color="#FF0000">}</font><font color="#990000">;</font>

<b><font color="#000080">#define</font></b>	<b><font color="#000000">COMPONENT_REGISTER</font></b><font color="#990000">(</font>Class<font color="#990000">,</font>Type<font color="#990000">,</font>Subtype<font color="#990000">,</font>Manufacturer<font color="#990000">)</font> <font color="#990000">\</font>
	<b><font color="#0000FF">static</font></b> <font color="#008080">ComponentRegistrar&lt;Class, Type, Subtype, Manufacturer&gt;</font>	gRegistrar##Class
<b><font color="#000080">#else</font></b>
<b><font color="#000080">#define</font></b> <b><font color="#000000">COMPONENT_ENTRY</font></b><font color="#990000">(</font>Class<font color="#990000">)</font>
<b><font color="#000080">#define</font></b> <b><font color="#000000">COMPONENT_REGISTER</font></b><font color="#990000">(</font>Class<font color="#990000">)</font>
<i><font color="#9A1900">// this macro is used to generate the Entry Point for a given Audio Plugin</font></i>
<i><font color="#9A1900">// you should be using this macro now with audio components</font></i>
<b><font color="#000080">#define</font></b> <b><font color="#000000">AUDIOCOMPONENT_ENTRY</font></b><font color="#990000">(</font>FactoryType<font color="#990000">,</font> Class<font color="#990000">)</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#009900">void</font> <font color="#990000">*</font> Class##<b><font color="#000000">Factory</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioComponentDescription</font> <font color="#990000">*</font>inDesc<font color="#990000">);</font> <font color="#990000">\</font>
    <b><font color="#0000FF">extern</font></b> <font color="#FF0000">"C"</font> <font color="#009900">void</font> <font color="#990000">*</font> Class##<b><font color="#000000">Factory</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioComponentDescription</font> <font color="#990000">*</font>inDesc<font color="#990000">)</font> <font color="#FF0000">{</font> <font color="#990000">\</font>
        <b><font color="#0000FF">return</font></b> FactoryType<font color="#990000">&lt;</font>Class<font color="#990000">&gt;::</font><b><font color="#000000">Factory</font></b><font color="#990000">(</font>inDesc<font color="#990000">);</font> <font color="#990000">\</font>
    <font color="#FF0000">}</font>

<b><font color="#000080">#endif</font></b> <i><font color="#9A1900">// !CA_USE_AUDIO_PLUGIN_ONLY</font></i>


<b><font color="#000080">#endif</font></b> <i><font color="#9A1900">// __ComponentBase_h__</font></i>
</tt></pre>
