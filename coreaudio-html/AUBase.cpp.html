<!-- Generator: GNU source-highlight 3.1.7
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>
<i><font color="#9A1900">/*   Path: ~/lab/CoreAudioUtilityClasses/Mac/CoreAudioUtilityClasses/CoreAudio/AudioUnits/AUPublic/AUBase/AUBase.cpp  */</font></i>

<i><font color="#9A1900">/*</font></i>
<i><font color="#9A1900">     File: AUBase.cpp </font></i>
<i><font color="#9A1900"> Abstract:  AUBase.h  </font></i>
<i><font color="#9A1900">  Version: 1.0.4 </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple </font></i>
<i><font color="#9A1900"> Inc. ("Apple") in consideration of your agreement to the following </font></i>
<i><font color="#9A1900"> terms, and your use, installation, modification or redistribution of </font></i>
<i><font color="#9A1900"> this Apple software constitutes acceptance of these terms.  If you do </font></i>
<i><font color="#9A1900"> not agree with these terms, please do not use, install, modify or </font></i>
<i><font color="#9A1900"> redistribute this Apple software. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> In consideration of your agreement to abide by the following terms, and </font></i>
<i><font color="#9A1900"> subject to these terms, Apple grants you a personal, non-exclusive </font></i>
<i><font color="#9A1900"> license, under Apple's copyrights in this original Apple software (the </font></i>
<i><font color="#9A1900"> "Apple Software"), to use, reproduce, modify and redistribute the Apple </font></i>
<i><font color="#9A1900"> Software, with or without modifications, in source and/or binary forms; </font></i>
<i><font color="#9A1900"> provided that if you redistribute the Apple Software in its entirety and </font></i>
<i><font color="#9A1900"> without modifications, you must retain this notice and the following </font></i>
<i><font color="#9A1900"> text and disclaimers in all such redistributions of the Apple Software. </font></i>
<i><font color="#9A1900"> Neither the name, trademarks, service marks or logos of Apple Inc. may </font></i>
<i><font color="#9A1900"> be used to endorse or promote products derived from the Apple Software </font></i>
<i><font color="#9A1900"> without specific prior written permission from Apple.  Except as </font></i>
<i><font color="#9A1900"> expressly stated in this notice, no other rights or licenses, express or </font></i>
<i><font color="#9A1900"> implied, are granted by Apple herein, including but not limited to any </font></i>
<i><font color="#9A1900"> patent rights that may be infringed by your derivative works or by other </font></i>
<i><font color="#9A1900"> works in which the Apple Software may be incorporated. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> The Apple Software is provided by Apple on an "AS IS" basis.  APPLE </font></i>
<i><font color="#9A1900"> MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION </font></i>
<i><font color="#9A1900"> THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS </font></i>
<i><font color="#9A1900"> FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND </font></i>
<i><font color="#9A1900"> OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL </font></i>
<i><font color="#9A1900"> OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF </font></i>
<i><font color="#9A1900"> SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS </font></i>
<i><font color="#9A1900"> INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION, </font></i>
<i><font color="#9A1900"> MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED </font></i>
<i><font color="#9A1900"> AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE), </font></i>
<i><font color="#9A1900"> STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE </font></i>
<i><font color="#9A1900"> POSSIBILITY OF SUCH DAMAGE. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900"> Copyright (C) 2013 Apple Inc. All Rights Reserved. </font></i>
<i><font color="#9A1900">  </font></i>
<i><font color="#9A1900">*/</font></i>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"AUBase.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"AUDispatch.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"AUInputElement.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"AUOutputElement.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;algorithm&gt;</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CAAudioChannelLayout.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CAHostTimeBase.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CAVectorUnit.h"</font>
<b><font color="#000080">#include</font></b> <font color="#FF0000">"CAXException.h"</font>



<b><font color="#000080">#if</font></b> TARGET_OS_MAC <font color="#990000">&amp;&amp;</font> <font color="#990000">(</font>TARGET_CPU_X86 <font color="#990000">||</font> TARGET_CPU_X86_64<font color="#990000">)</font>
	<i><font color="#9A1900">// our compiler does ALL floating point with SSE</font></i>
	<b><font color="#0000FF">inline</font></b> <font color="#009900">int</font>  <b><font color="#000000">GETCSR</font></b> <font color="#990000">()</font>    <font color="#FF0000">{</font> <font color="#009900">int</font> _result<font color="#990000">;</font> <b><font color="#0000FF">asm</font></b> <b><font color="#0000FF">volatile</font></b> <font color="#990000">(</font><font color="#FF0000">"stmxcsr %0"</font> <font color="#990000">:</font> <font color="#FF0000">"=m"</font> <font color="#990000">(*&amp;</font>_result<font color="#990000">)</font> <font color="#990000">);</font> <b><font color="#0000FF">return</font></b> _result<font color="#990000">;</font> <font color="#FF0000">}</font>
	<b><font color="#0000FF">inline</font></b> <font color="#009900">void</font> <b><font color="#000000">SETCSR</font></b> <font color="#990000">(</font><font color="#009900">int</font> a<font color="#990000">)</font>    <font color="#FF0000">{</font> <font color="#009900">int</font> _temp <font color="#990000">=</font> a<font color="#990000">;</font> <b><font color="#0000FF">asm</font></b> <b><font color="#0000FF">volatile</font></b><font color="#990000">(</font> <font color="#FF0000">"ldmxcsr %0"</font> <font color="#990000">:</font> <font color="#990000">:</font> <font color="#FF0000">"m"</font> <font color="#990000">(*&amp;</font>_temp <font color="#990000">)</font> <font color="#990000">);</font> <font color="#FF0000">}</font>

<b><font color="#000080">	#define</font></b> <font color="#008080">DISABLE_DENORMALS</font> <font color="#009900">int</font> _savemxcsr <font color="#990000">=</font> <b><font color="#000000">GETCSR</font></b><font color="#990000">();</font> <b><font color="#000000">SETCSR</font></b><font color="#990000">(</font>_savemxcsr <font color="#990000">|</font> <font color="#993399">0x8040</font><font color="#990000">);</font>
<b><font color="#000080">	#define</font></b> <font color="#008080">RESTORE_DENORMALS</font> <b><font color="#000000">SETCSR</font></b><font color="#990000">(</font>_savemxcsr<font color="#990000">);</font>
<b><font color="#000080">#else</font></b>
<b><font color="#000080">	#define</font></b> DISABLE_DENORMALS
<b><font color="#000080">	#define</font></b> RESTORE_DENORMALS
<b><font color="#000080">#endif</font></b>

<b><font color="#0000FF">static</font></b> <font color="#009900">bool</font> sAUBaseCFStringsInitialized <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
<i><font color="#9A1900">// this is used for the presets</font></i>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kUntitledString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<i><font color="#9A1900">//these are the current keys for the class info document</font></i>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kVersionString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kTypeString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kSubtypeString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kManufacturerString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kDataString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kNameString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kRenderQualityString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kCPULoadString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kElementNameString <font color="#990000">=</font> NULL<font color="#990000">;</font>
<b><font color="#0000FF">static</font></b> <font color="#008080">CFStringRef</font> kPartString <font color="#990000">=</font> NULL<font color="#990000">;</font>

<font color="#008080">SInt32</font> AUBase<font color="#990000">::</font>sVectorUnitType <font color="#990000">=</font> kVecUninitialized<font color="#990000">;</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
AUBase<font color="#990000">::</font><b><font color="#000000">AUBase</font></b><font color="#990000">(</font>	<font color="#008080">AudioComponentInstance</font>			inInstance<font color="#990000">,</font> 
				<font color="#008080">UInt32</font>							numInputElements<font color="#990000">,</font>
				<font color="#008080">UInt32</font>							numOutputElements<font color="#990000">,</font>
				<font color="#008080">UInt32</font>							numGroupElements<font color="#990000">)</font> <font color="#990000">:</font>
	<b><font color="#000000">ComponentBase</font></b><font color="#990000">(</font>inInstance<font color="#990000">),</font>
	<b><font color="#000000">mElementsCreated</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mInitialized</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mHasBegunInitializing</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mInitNumInputEls</font></b><font color="#990000">(</font>numInputElements<font color="#990000">),</font> <b><font color="#000000">mInitNumOutputEls</font></b><font color="#990000">(</font>numOutputElements<font color="#990000">),</font> 
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_BASIC_AU_FEATURES
	<b><font color="#000000">mInitNumGroupEls</font></b><font color="#990000">(</font>numGroupElements<font color="#990000">),</font>
<b><font color="#000080">#endif</font></b>
	<b><font color="#000000">mRenderCallbacksTouched</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mRenderThreadID</font></b> <font color="#990000">(</font>NULL<font color="#990000">),</font>
	<b><font color="#000000">mWantsRenderThreadID</font></b> <font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mLastRenderError</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">),</font>
	<b><font color="#000000">mBuffersAllocated</font></b><font color="#990000">(</font><b><font color="#0000FF">false</font></b><font color="#990000">),</font>
	<b><font color="#000000">mLogString</font></b> <font color="#990000">(</font>NULL<font color="#990000">)</font>
<b><font color="#000080">	#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
		<font color="#990000">,</font>
		<b><font color="#000000">mContextName</font></b><font color="#990000">(</font>NULL<font color="#990000">)</font>
<b><font color="#000080">	#endif</font></b>
<font color="#FF0000">{</font>
	<b><font color="#000000">ResetRenderTime</font></b> <font color="#990000">();</font>
	
	<b><font color="#0000FF">if</font></b><font color="#990000">(!</font>sAUBaseCFStringsInitialized<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		kUntitledString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font><font color="#FF0000">"Untitled"</font><font color="#990000">);</font>
		kVersionString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetVersionKey<font color="#990000">);</font>
		kTypeString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetTypeKey<font color="#990000">);</font>
		kSubtypeString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetSubtypeKey<font color="#990000">);</font>
		kManufacturerString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetManufacturerKey<font color="#990000">);</font>
		kDataString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetDataKey<font color="#990000">);</font>
		kNameString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetNameKey<font color="#990000">);</font>
		kRenderQualityString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetRenderQualityKey<font color="#990000">);</font>
		kCPULoadString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetCPULoadKey<font color="#990000">);</font>
		kElementNameString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetElementNameKey<font color="#990000">);</font>
		kPartString <font color="#990000">=</font> <b><font color="#000000">CFSTR</font></b><font color="#990000">(</font>kAUPresetPartKey<font color="#990000">);</font>
		sAUBaseCFStringsInitialized <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>

	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>sVectorUnitType <font color="#990000">==</font> kVecUninitialized<font color="#990000">)</font> <font color="#FF0000">{</font>
		sVectorUnitType <font color="#990000">=</font> CAVectorUnit<font color="#990000">::</font><b><font color="#000000">GetVectorUnitType</font></b><font color="#990000">()</font> <font color="#990000">;</font>
	<font color="#FF0000">}</font>

	mAudioUnitAPIVersion <font color="#990000">=</font> <font color="#993399">2</font><font color="#990000">;</font>
	
	<b><font color="#000000">SetMaxFramesPerSlice</font></b><font color="#990000">(</font>kAUDefaultMaxFramesPerSlice<font color="#990000">);</font>

	<b><font color="#000000">GlobalScope</font></b><font color="#990000">().</font><b><font color="#000000">Initialize</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> kAudioUnitScope_Global<font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">);</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mAudioUnitAPIVersion <font color="#990000">&gt;</font> <font color="#993399">1</font><font color="#990000">)</font> 
		mParamList<font color="#990000">.</font><b><font color="#000000">reserve</font></b> <font color="#990000">(</font><font color="#993399">24</font><font color="#990000">);</font>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<b><font color="#000000">memset</font></b> <font color="#990000">(&amp;</font>mHostCallbackInfo<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>mHostCallbackInfo<font color="#990000">));</font>
<b><font color="#000080">#endif</font></b>


	mCurrentPreset<font color="#990000">.</font>presetNumber <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
	mCurrentPreset<font color="#990000">.</font>presetName <font color="#990000">=</font> kUntitledString<font color="#990000">;</font>
	<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
AUBase<font color="#990000">::~</font><b><font color="#000000">AUBase</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">)</font> <b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mContextName<font color="#990000">)</font> <b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>mContextName<font color="#990000">);</font>
<b><font color="#000080">#endif</font></b>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mLogString<font color="#990000">)</font> <b><font color="#0000FF">delete</font></b> <font color="#990000">[]</font> mLogString<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>	AUBase<font color="#990000">::</font><b><font color="#000000">CreateElements</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>mElementsCreated<font color="#990000">)</font> <font color="#FF0000">{</font>
		<b><font color="#000000">Inputs</font></b><font color="#990000">().</font><b><font color="#000000">Initialize</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> kAudioUnitScope_Input<font color="#990000">,</font> mInitNumInputEls<font color="#990000">);</font>
		<b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">Initialize</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> kAudioUnitScope_Output<font color="#990000">,</font> mInitNumOutputEls<font color="#990000">);</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_BASIC_AU_FEATURES
		<b><font color="#000000">Groups</font></b><font color="#990000">().</font><b><font color="#000000">Initialize</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> kAudioUnitScope_Group<font color="#990000">,</font> mInitNumGroupEls<font color="#990000">);</font>
<b><font color="#000080">#endif</font></b>
		<b><font color="#000000">CreateExtendedElements</font></b><font color="#990000">();</font>
		
		mElementsCreated <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>	AUBase<font color="#990000">::</font><b><font color="#000000">SetMaxFramesPerSlice</font></b><font color="#990000">(</font><font color="#008080">UInt32</font> nFrames<font color="#990000">)</font>
<font color="#FF0000">{</font>
	mMaxFramesPerSlice <font color="#990000">=</font> nFrames<font color="#990000">;</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mBuffersAllocated<font color="#990000">)</font>
		<b><font color="#000000">ReallocateBuffers</font></b><font color="#990000">();</font>
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>kAudioUnitProperty_MaximumFramesPerSlice<font color="#990000">,</font> kAudioUnitScope_Global<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">CanSetMaxFrames</font></b><font color="#990000">()</font> <b><font color="#0000FF">const</font></b>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#000000">IsInitialized</font></b><font color="#990000">()</font> <font color="#990000">?</font> kAudioUnitErr_Initialized <font color="#990000">:</font> <b><font color="#000000">OSStatus</font></b><font color="#990000">(</font>noErr<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">ReallocateBuffers</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#000000">CreateElements</font></b><font color="#990000">();</font>
	
	<font color="#009900">int</font> i<font color="#990000">;</font>
	<font color="#009900">int</font> nOutputs <font color="#990000">=</font> <b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">GetNumberOfElements</font></b><font color="#990000">();</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> nOutputs<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">AUOutputElement</font> <font color="#990000">*</font>output <font color="#990000">=</font> <b><font color="#000000">GetOutput</font></b><font color="#990000">(</font>i<font color="#990000">);</font>
		output<font color="#990000">-&gt;</font><b><font color="#000000">AllocateBuffer</font></b><font color="#990000">();</font>	<i><font color="#9A1900">// does no work if already allocated</font></i>
	<font color="#FF0000">}</font>
	<font color="#009900">int</font> nInputs <font color="#990000">=</font> <b><font color="#000000">Inputs</font></b><font color="#990000">().</font><b><font color="#000000">GetNumberOfElements</font></b><font color="#990000">();</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font>i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> nInputs<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>i<font color="#990000">);</font>
		input<font color="#990000">-&gt;</font><b><font color="#000000">AllocateBuffer</font></b><font color="#990000">();</font>	<i><font color="#9A1900">// does no work if already allocated</font></i>
	<font color="#FF0000">}</font>
	mBuffersAllocated <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DoInitialize</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>mInitialized<font color="#990000">)</font> <font color="#FF0000">{</font>
		result <font color="#990000">=</font> <b><font color="#000000">Initialize</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font> <font color="#FF0000">{</font>
			mHasBegunInitializing <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
			<b><font color="#000000">ReallocateBuffers</font></b><font color="#990000">();</font>	<i><font color="#9A1900">// calls CreateElements()</font></i>
			mInitialized <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>	<i><font color="#9A1900">// signal that it's okay to render</font></i>
			<b><font color="#000000">CAMemoryBarrier</font></b><font color="#990000">();</font>
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>

	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">Initialize</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">PreDestructor</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#000000">DoCleanup</font></b><font color="#990000">();</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">DoCleanup</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mInitialized<font color="#990000">)</font>
		<b><font color="#000000">Cleanup</font></b><font color="#990000">();</font>
		
	<b><font color="#000000">ResetRenderTime</font></b> <font color="#990000">();</font>

	mInitialized <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
	mHasBegunInitializing <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">Cleanup</font></b><font color="#990000">()</font>
<font color="#FF0000">{</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">Reset</font></b><font color="#990000">(</font>					<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#000000">ResetRenderTime</font></b> <font color="#990000">();</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DispatchGetPropertyInfo</font></b><font color="#990000">(</font><font color="#008080">AudioUnitPropertyID</font>				inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">,</font>
													UInt32 <font color="#990000">&amp;</font>						outDataSize<font color="#990000">,</font>
													Boolean <font color="#990000">&amp;</font>						outWritable<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
	<font color="#009900">bool</font> validateElement <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inID<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_MakeConnection<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Input <font color="#990000">||</font> inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitConnection<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SetRenderCallback<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">AudioUnitAPIVersion</font></b><font color="#990000">()</font> <font color="#990000">&gt;</font> <font color="#993399">1</font><font color="#990000">,</font> InvalidProperty<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Input <font color="#990000">||</font> inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AURenderCallbackStruct<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_StreamFormat<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CAStreamBasicDescription<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#000000">IsStreamFormatWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SampleRate<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Float64<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#000000">IsStreamFormatWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ClassInfo<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFPropertyListRef<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_FactoryPresets<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		result <font color="#990000">=</font> <b><font color="#000000">GetPresets</font></b><font color="#990000">(</font>NULL<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>result<font color="#990000">)</font> <font color="#FF0000">{</font>
			outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFArrayRef<font color="#990000">);</font>
			outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_PresentPreset<font color="#990000">:</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">#ifndef</font></b> __LP64__
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_CurrentPreset<font color="#990000">:</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#000080">#endif</font></b>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AUPreset<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementName<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>CFStringRef<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterList<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#008080">UInt32</font> nparams <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">GetParameterList</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> NULL<font color="#990000">,</font> nparams<font color="#990000">);</font>
			
			outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitParameterID<font color="#990000">)</font> <font color="#990000">*</font> nparams<font color="#990000">;</font>
			outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
			validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterInfo<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitParameterInfo<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterHistoryInfo<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitParameterHistoryInfo<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementCount<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#000000">BusCountWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">);</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_Latency<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Float64<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_TailTime<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">SupportsTail</font></b><font color="#990000">())</font> <font color="#FF0000">{</font>
			outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Float64<font color="#990000">);</font>
			outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
			<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_MaximumFramesPerSlice<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_LastRenderError<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>OSStatus<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SupportedNumChannels<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		<font color="#008080">UInt32</font> num <font color="#990000">=</font> <b><font color="#000000">SupportedNumChannels</font></b> <font color="#990000">(</font>NULL<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>num<font color="#990000">)</font> <font color="#FF0000">{</font>
			outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>AUChannelInfo<font color="#990000">)</font> <font color="#990000">*</font> num<font color="#990000">;</font>
			result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
			<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SupportedChannelLayoutTags<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		<font color="#008080">UInt32</font> numLayouts <font color="#990000">=</font> <b><font color="#000000">GetChannelLayoutTags</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> NULL<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>numLayouts<font color="#990000">)</font> <font color="#FF0000">{</font>
			outDataSize <font color="#990000">=</font> numLayouts <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioChannelLayoutTag<font color="#990000">);</font>
			result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
			<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font> <i><font color="#9A1900">//already done it</font></i>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_AudioChannelLayout<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		outDataSize <font color="#990000">=</font> <b><font color="#000000">GetAudioChannelLayout</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> NULL<font color="#990000">,</font> outWritable<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>outDataSize<font color="#990000">)</font> <font color="#FF0000">{</font>
			result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">GetChannelLayoutTags</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> NULL<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font>
				<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
			<b><font color="#0000FF">else</font></b>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font> <i><font color="#9A1900">//already done it</font></i>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>

<b><font color="#000080">#if</font></b> <font color="#990000">(</font>MAC_OS_X_VERSION_MIN_REQUIRED <font color="#990000">&gt;</font> MAC_OS_X_VERSION_10_5<font color="#990000">)</font> <font color="#990000">||</font> TARGET_OS_IPHONE
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ShouldAllocateBuffer<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">((</font>inScope <font color="#990000">==</font> kAudioUnitScope_Input <font color="#990000">||</font> inScope <font color="#990000">==</font> kAudioUnitScope_Output<font color="#990000">),</font> InvalidScope<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_FastDispatch<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><b><font color="#000000">IsCMgrObject</font></b><font color="#990000">())</font> <b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font><font color="#009900">void</font> <font color="#990000">*);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_GetUIComponentList<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#000000">GetNumCustomUIComponents</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>outDataSize <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font>
			<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		outDataSize <font color="#990000">*=</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>AudioComponentDescription<font color="#990000">);</font>
		
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
	
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ContextName<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFStringRef<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterValueStrings<font color="#990000">:</font>
		result <font color="#990000">=</font> <b><font color="#000000">GetParameterValueStrings</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> NULL<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font> <font color="#FF0000">{</font>
			outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFArrayRef<font color="#990000">);</font>
			outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
			validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_HostCallbacks<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>HostCallbackInfo<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_IconLocation<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><b><font color="#000000">HasIcon</font></b><font color="#990000">())</font>
			<b><font color="#0000FF">goto</font></b> InvalidProperty<font color="#990000">;</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFURLRef<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterClumpName<font color="#990000">:</font>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitParameterNameInfo <font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b> <i><font color="#9A1900">// !CA_NO_AU_UI_FEATURES</font></i>

	<b><font color="#0000FF">case</font></b> <font color="#FF0000">'lrst'</font> <font color="#990000">:</font>  <i><font color="#9A1900">// kAudioUnitProperty_LastRenderedSampleTime</font></i>
		outDataSize <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Float64<font color="#990000">);</font>
		outWritable <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
<b><font color="#008080">	default:</font></b>
		result <font color="#990000">=</font> <b><font color="#000000">GetPropertyInfo</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> outDataSize<font color="#990000">,</font> outWritable<font color="#990000">);</font>
		validateElement <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>

	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr <font color="#990000">&amp;&amp;</font> validateElement<font color="#990000">)</font> <font color="#FF0000">{</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)</font> <font color="#990000">!=</font> NULL<font color="#990000">,</font> InvalidElement<font color="#990000">);</font>	
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<b><font color="#008080">InvalidProperty:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<b><font color="#008080">InvalidScope:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidScope<font color="#990000">;</font>
<b><font color="#008080">InvalidElement:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidElement<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DispatchGetProperty</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitPropertyID</font> 			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>			 	inElement<font color="#990000">,</font>
													<font color="#009900">void</font> <font color="#990000">*</font>							outData<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<i><font color="#9A1900">// NOTE: We're currently only called from AUBase::ComponentEntryDispatch, which</font></i>
	<i><font color="#9A1900">// calls DispatchGetPropertyInfo first, which performs validation of the scope/element,</font></i>
	<i><font color="#9A1900">// and ensures that the outData buffer is non-null and large enough.</font></i>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>

	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inID<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_StreamFormat<font color="#990000">:</font>
		<font color="#990000">*(</font>CAStreamBasicDescription <font color="#990000">*)</font>outData <font color="#990000">=</font> <b><font color="#000000">GetStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SampleRate<font color="#990000">:</font>
		<font color="#990000">*(</font>Float64 <font color="#990000">*)</font>outData <font color="#990000">=</font> <b><font color="#000000">GetStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">).</font>mSampleRate<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterList<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#008080">UInt32</font> nparams <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">GetParameterList</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> <font color="#990000">(</font>AudioUnitParameterID <font color="#990000">*)</font>outData<font color="#990000">,</font> nparams<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterInfo<font color="#990000">:</font>
		result <font color="#990000">=</font> <b><font color="#000000">GetParameterInfo</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> <font color="#990000">*(</font>AudioUnitParameterInfo <font color="#990000">*)</font>outData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterHistoryInfo<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			AudioUnitParameterHistoryInfo<font color="#990000">*</font> info <font color="#990000">=</font> <font color="#990000">(</font>AudioUnitParameterHistoryInfo<font color="#990000">*)</font>outData<font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">GetParameterHistoryInfo</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> info<font color="#990000">-&gt;</font>updatesPerSecond<font color="#990000">,</font> info<font color="#990000">-&gt;</font>historyDurationInSeconds<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ClassInfo<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#990000">*(</font>CFPropertyListRef <font color="#990000">*)</font>outData <font color="#990000">=</font> NULL<font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">SaveState</font></b><font color="#990000">((</font>CFPropertyListRef <font color="#990000">*)</font>outData<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_FactoryPresets<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#990000">*(</font>CFArrayRef <font color="#990000">*)</font>outData <font color="#990000">=</font> NULL<font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">GetPresets</font></b> <font color="#990000">((</font>CFArrayRef <font color="#990000">*)</font>outData<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_PresentPreset<font color="#990000">:</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">#ifndef</font></b> __LP64__
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_CurrentPreset<font color="#990000">:</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#000080">#endif</font></b>
		<font color="#FF0000">{</font>
			<font color="#990000">*(</font>AUPreset <font color="#990000">*)</font>outData <font color="#990000">=</font> mCurrentPreset<font color="#990000">;</font>
				
				<i><font color="#9A1900">// retain current string (as client owns a reference to it and will release it)</font></i>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inID <font color="#990000">==</font> kAudioUnitProperty_PresentPreset <font color="#990000">&amp;&amp;</font> mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">)</font> 
				<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>

			result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementName<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			AUElement <font color="#990000">*</font> element <font color="#990000">=</font> <b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>element<font color="#990000">-&gt;</font><b><font color="#000000">HasName</font></b><font color="#990000">())</font> <font color="#FF0000">{</font>
				<font color="#990000">*(</font>CFStringRef <font color="#990000">*)</font>outData <font color="#990000">=</font> element<font color="#990000">-&gt;</font><b><font color="#000000">GetName</font></b><font color="#990000">();</font>
				<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>element<font color="#990000">-&gt;</font><b><font color="#000000">GetName</font></b><font color="#990000">());</font>
				result <font color="#990000">=</font> noErr<font color="#990000">;</font>
			<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementCount<font color="#990000">:</font>
		<font color="#990000">*(</font>UInt32 <font color="#990000">*)</font>outData <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b><font color="#990000">(</font>inScope<font color="#990000">).</font><b><font color="#000000">GetNumberOfElements</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_Latency<font color="#990000">:</font>
		<font color="#990000">*(</font>Float64 <font color="#990000">*)</font>outData <font color="#990000">=</font> <b><font color="#000000">GetLatency</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_TailTime<font color="#990000">:</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">SupportsTail</font></b><font color="#990000">())</font>
			<font color="#990000">*(</font>Float64 <font color="#990000">*)</font>outData <font color="#990000">=</font> <b><font color="#000000">GetTailTime</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">else</font></b>
			result <font color="#990000">=</font> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_MaximumFramesPerSlice<font color="#990000">:</font>
		<font color="#990000">*(</font>UInt32 <font color="#990000">*)</font>outData <font color="#990000">=</font> mMaxFramesPerSlice<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_LastRenderError<font color="#990000">:</font>
		<font color="#990000">*(</font>OSStatus <font color="#990000">*)</font>outData <font color="#990000">=</font> mLastRenderError<font color="#990000">;</font>
		mLastRenderError <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SupportedNumChannels<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#0000FF">const</font></b> AUChannelInfo<font color="#990000">*</font> infoPtr<font color="#990000">;</font>
			<font color="#008080">UInt32</font> num <font color="#990000">=</font> <b><font color="#000000">SupportedNumChannels</font></b> <font color="#990000">(&amp;</font>infoPtr<font color="#990000">);</font>
			<b><font color="#000000">memcpy</font></b> <font color="#990000">(</font>outData<font color="#990000">,</font> infoPtr<font color="#990000">,</font> num <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>AUChannelInfo<font color="#990000">));</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SupportedChannelLayoutTags<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			AudioChannelLayoutTag<font color="#990000">*</font> ptr <font color="#990000">=</font> outData <font color="#990000">?</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>AudioChannelLayoutTag<font color="#990000">*&gt;(</font>outData<font color="#990000">)</font> <font color="#990000">:</font> NULL<font color="#990000">;</font>
			<font color="#008080">UInt32</font> numLayouts <font color="#990000">=</font> <b><font color="#000000">GetChannelLayoutTags</font></b> <font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> ptr<font color="#990000">);</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>numLayouts <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_AudioChannelLayout<font color="#990000">:</font>
	<font color="#FF0000">{</font>	
		AudioChannelLayout<font color="#990000">*</font> ptr <font color="#990000">=</font> outData <font color="#990000">?</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>AudioChannelLayout<font color="#990000">*&gt;(</font>outData<font color="#990000">)</font> <font color="#990000">:</font> NULL<font color="#990000">;</font>
		<font color="#008080">Boolean</font> writable<font color="#990000">;</font>
		<font color="#008080">UInt32</font> dataSize <font color="#990000">=</font> <b><font color="#000000">GetAudioChannelLayout</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> ptr<font color="#990000">,</font> writable<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>dataSize<font color="#990000">)</font> <font color="#FF0000">{</font>
			result <font color="#990000">=</font> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>

<b><font color="#000080">#if</font></b> <font color="#990000">(</font>MAC_OS_X_VERSION_MIN_REQUIRED <font color="#990000">&gt;</font> MAC_OS_X_VERSION_10_5<font color="#990000">)</font> <font color="#990000">||</font> TARGET_OS_IPHONE
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ShouldAllocateBuffer<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		AUIOElement <font color="#990000">*</font> element <font color="#990000">=</font> <b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<font color="#990000">*(</font>UInt32<font color="#990000">*)</font>outData <font color="#990000">=</font> element<font color="#990000">-&gt;</font><b><font color="#000000">WillAllocateBuffer</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#000080">#endif</font></b>

		
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_FastDispatch<font color="#990000">:</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font><b><font color="#000000">IsCMgrObject</font></b><font color="#990000">())</font> result <font color="#990000">=</font> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
		<b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
			<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inElement<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#0000FF">case</font></b> kAudioUnitGetParameterSelect<font color="#990000">:</font>
				<font color="#990000">*(</font>AudioUnitGetParameterProc <font color="#990000">*)</font>outData <font color="#990000">=</font> <font color="#990000">(</font>AudioUnitGetParameterProc<font color="#990000">)</font>CMgr_AudioUnitBaseGetParameter<font color="#990000">;</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			<b><font color="#0000FF">case</font></b> kAudioUnitSetParameterSelect<font color="#990000">:</font>
				<font color="#990000">*(</font>AudioUnitSetParameterProc <font color="#990000">*)</font>outData <font color="#990000">=</font> <font color="#990000">(</font>AudioUnitSetParameterProc<font color="#990000">)</font>CMgr_AudioUnitBaseSetParameter<font color="#990000">;</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			<b><font color="#0000FF">case</font></b> kAudioUnitRenderSelect<font color="#990000">:</font>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">AudioUnitAPIVersion</font></b><font color="#990000">()</font> <font color="#990000">&gt;</font> <font color="#993399">1</font><font color="#990000">)</font>
					<font color="#990000">*(</font>AudioUnitRenderProc <font color="#990000">*)</font>outData <font color="#990000">=</font> <font color="#990000">(</font>AudioUnitRenderProc<font color="#990000">)</font>CMgr_AudioUnitBaseRender<font color="#990000">;</font>
				<b><font color="#0000FF">else</font></b> result <font color="#990000">=</font> kAudioUnitErr_InvalidElement<font color="#990000">;</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#008080">			default:</font></b>
				result <font color="#990000">=</font> <b><font color="#000000">GetProperty</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> outData<font color="#990000">);</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_GetUIComponentList<font color="#990000">:</font>
		<b><font color="#000000">GetUIComponentDescs</font></b> <font color="#990000">((</font>ComponentDescription<font color="#990000">*)</font>outData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
 	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterValueStrings<font color="#990000">:</font>
		result <font color="#990000">=</font> <b><font color="#000000">GetParameterValueStrings</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> <font color="#990000">(</font>CFArrayRef <font color="#990000">*)</font>outData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_IconLocation<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#008080">CFURLRef</font> iconLocation <font color="#990000">=</font> <b><font color="#000000">CopyIconLocation</font></b><font color="#990000">();</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>iconLocation<font color="#990000">)</font> <font color="#FF0000">{</font>
				<font color="#990000">*(</font>CFURLRef<font color="#990000">*)</font>outData <font color="#990000">=</font> iconLocation<font color="#990000">;</font>
			<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_HostCallbacks<font color="#990000">:</font>
		<font color="#990000">*(</font>HostCallbackInfo <font color="#990000">*)</font>outData <font color="#990000">=</font> mHostCallbackInfo<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ContextName<font color="#990000">:</font>
		<font color="#990000">*(</font>CFStringRef <font color="#990000">*)</font>outData <font color="#990000">=</font> mContextName<font color="#990000">;</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mContextName<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">CFRetain</font></b><font color="#990000">(</font>mContextName<font color="#990000">);</font>
			<i><font color="#9A1900">// retain CFString (if exists) since client will be responsible for its release</font></i>
			result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
			result <font color="#990000">=</font> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ParameterClumpName<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			AudioUnitParameterNameInfo <font color="#990000">*</font> ioClumpInfo <font color="#990000">=</font> <font color="#990000">(</font>AudioUnitParameterNameInfo<font color="#990000">*)</font> outData<font color="#990000">;</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>ioClumpInfo<font color="#990000">-&gt;</font>inID <font color="#990000">==</font> kAudioUnitClumpID_System<font color="#990000">)</font>	<i><font color="#9A1900">// this ID value is reserved</font></i>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
			<b><font color="#0000FF">else</font></b> 
			<font color="#FF0000">{</font>
				result <font color="#990000">=</font> <b><font color="#000000">CopyClumpName</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> ioClumpInfo<font color="#990000">-&gt;</font>inID<font color="#990000">,</font> ioClumpInfo<font color="#990000">-&gt;</font>inDesiredLength<font color="#990000">,</font> <font color="#990000">&amp;</font>ioClumpInfo<font color="#990000">-&gt;</font>outName<font color="#990000">);</font>
					
					<i><font color="#9A1900">// this is provided for compatbility with existing implementations that don't know</font></i>
					<i><font color="#9A1900">// about this new mechanism</font></i>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> kAudioUnitErr_InvalidProperty<font color="#990000">)</font>
					result <font color="#990000">=</font> <b><font color="#000000">GetProperty</font></b> <font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> outData<font color="#990000">);</font>
			<font color="#FF0000">}</font>	
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#endif</font></b>  <i><font color="#9A1900">// !CA_NO_AU_UI_FEATURES</font></i>

	<b><font color="#0000FF">case</font></b> <font color="#FF0000">'lrst'</font> <font color="#990000">:</font> <i><font color="#9A1900">// kAudioUnitProperty_LastRenderedSampleTime</font></i>
		<font color="#990000">*(</font>Float64<font color="#990000">*)</font>outData <font color="#990000">=</font> mCurrentRenderTime<font color="#990000">.</font>mSampleTime<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#008080">	default:</font></b>
		result <font color="#990000">=</font> <b><font color="#000000">GetProperty</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> outData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<font color="#FF0000">}</font>


<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DispatchSetProperty</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitPropertyID</font> 			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">,</font>
													<b><font color="#0000FF">const</font></b> <font color="#009900">void</font> <font color="#990000">*</font>					inData<font color="#990000">,</font>
													<font color="#008080">UInt32</font> 							inDataSize<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>

	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inID<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_MakeConnection<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">&gt;=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitConnection<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
		<font color="#FF0000">{</font>
			<font color="#008080">AudioUnitConnection</font> <font color="#990000">&amp;</font>connection <font color="#990000">=</font> <font color="#990000">*(</font>AudioUnitConnection <font color="#990000">*)</font>inData<font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">SetConnection</font></b><font color="#990000">(</font>connection<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

		
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SetRenderCallback<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">&gt;=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AURenderCallbackStruct<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">AudioUnitAPIVersion</font></b><font color="#990000">()</font> <font color="#990000">&gt;</font> <font color="#993399">1</font><font color="#990000">,</font> InvalidProperty<font color="#990000">);</font>
			<font color="#008080">AURenderCallbackStruct</font> <font color="#990000">&amp;</font>callback <font color="#990000">=</font> <font color="#990000">*(</font>AURenderCallbackStruct<font color="#990000">*)</font>inData<font color="#990000">;</font>
			result <font color="#990000">=</font> <b><font color="#000000">SetInputCallback</font></b><font color="#990000">(</font>kAudioUnitProperty_SetRenderCallback<font color="#990000">,</font> inElement<font color="#990000">,</font> callback<font color="#990000">.</font>inputProc<font color="#990000">,</font> callback<font color="#990000">.</font>inputProcRefCon<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementCount<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">BusCountWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">),</font> NotWritable<font color="#990000">);</font>
		result <font color="#990000">=</font> <b><font color="#000000">SetBusCount</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> <font color="#990000">*(</font>UInt32<font color="#990000">*)</font>inData<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_MaximumFramesPerSlice<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
		result <font color="#990000">=</font> <b><font color="#000000">CanSetMaxFrames</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
		<b><font color="#000000">SetMaxFramesPerSlice</font></b><font color="#990000">(*(</font>UInt32 <font color="#990000">*)</font>inData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_StreamFormat<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inDataSize <font color="#990000">&lt;</font> <font color="#993399">36</font><font color="#990000">)</font> <b><font color="#0000FF">goto</font></b> InvalidPropertyValue<font color="#990000">;</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)</font> <font color="#990000">!=</font> NULL<font color="#990000">,</font> InvalidElement<font color="#990000">);</font>

			<font color="#008080">CAStreamBasicDescription</font> newDesc<font color="#990000">;</font>
				<i><font color="#9A1900">// now we're going to be ultra conservative! because of discrepancies between</font></i>
				<i><font color="#9A1900">// sizes of this struct based on aligment padding inconsistencies</font></i>
			<b><font color="#000000">memset</font></b> <font color="#990000">(&amp;</font>newDesc<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>newDesc<font color="#990000">));</font>
			<b><font color="#000000">memcpy</font></b> <font color="#990000">(&amp;</font>newDesc<font color="#990000">,</font> inData<font color="#990000">,</font> <font color="#993399">36</font><font color="#990000">);</font>

			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">ValidFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> newDesc<font color="#990000">),</font> InvalidFormat<font color="#990000">);</font>

			<b><font color="#0000FF">const</font></b> <font color="#008080">CAStreamBasicDescription</font> curDesc <font color="#990000">=</font> <b><font color="#000000">GetStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font> <font color="#990000">!</font>curDesc<font color="#990000">.</font><b><font color="#000000">IsEqual</font></b><font color="#990000">(</font>newDesc<font color="#990000">,</font> <b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsStreamFormatWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">),</font> NotWritable<font color="#990000">);</font>
				result <font color="#990000">=</font> <b><font color="#000000">ChangeStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> curDesc<font color="#990000">,</font> newDesc<font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SampleRate<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>Float64<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)</font> <font color="#990000">!=</font> NULL<font color="#990000">,</font> InvalidElement<font color="#990000">);</font>

			<b><font color="#0000FF">const</font></b> <font color="#008080">CAStreamBasicDescription</font> curDesc <font color="#990000">=</font> <b><font color="#000000">GetStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			<font color="#008080">CAStreamBasicDescription</font> newDesc <font color="#990000">=</font> curDesc<font color="#990000">;</font>
			newDesc<font color="#990000">.</font>mSampleRate <font color="#990000">=</font> <font color="#990000">*(</font>Float64 <font color="#990000">*)</font>inData<font color="#990000">;</font>
			
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">ValidFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> newDesc<font color="#990000">),</font> InvalidFormat<font color="#990000">);</font>
			
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font> <font color="#990000">!</font>curDesc<font color="#990000">.</font><b><font color="#000000">IsEqual</font></b><font color="#990000">(</font>newDesc<font color="#990000">,</font> <b><font color="#0000FF">false</font></b><font color="#990000">)</font> <font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsStreamFormatWritable</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">),</font> NotWritable<font color="#990000">);</font>
				result <font color="#990000">=</font> <b><font color="#000000">ChangeStreamFormat</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> curDesc<font color="#990000">,</font> newDesc<font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_AudioChannelLayout<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#0000FF">const</font></b> <font color="#008080">AudioChannelLayout</font> <font color="#990000">*</font>layout <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">const</font></b> AudioChannelLayout <font color="#990000">*&gt;(</font>inData<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">&gt;=</font> <b><font color="#000000">offsetof</font></b><font color="#990000">(</font>AudioChannelLayout<font color="#990000">,</font> mChannelDescriptions<font color="#990000">)</font> <font color="#990000">+</font> layout<font color="#990000">-&gt;</font>mNumberChannelDescriptions <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioChannelDescription<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			result <font color="#990000">=</font> <b><font color="#000000">SetAudioChannelLayout</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> layout<font color="#990000">);</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font>
				<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ClassInfo<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFPropertyListRef <font color="#990000">*),</font> InvalidPropertyValue<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		result <font color="#990000">=</font> <b><font color="#000000">RestoreState</font></b><font color="#990000">(*(</font>CFPropertyListRef <font color="#990000">*)</font>inData<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_PresentPreset<font color="#990000">:</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">#ifndef</font></b> __LP64__
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_CurrentPreset<font color="#990000">:</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#000080">#endif</font></b>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AUPreset<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
			AUPreset <font color="#990000">&amp;</font> newPreset <font color="#990000">=</font> <font color="#990000">*(</font>AUPreset <font color="#990000">*)</font>inData<font color="#990000">;</font>
			
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>newPreset<font color="#990000">.</font>presetNumber <font color="#990000">&gt;=</font> <font color="#993399">0</font><font color="#990000">)</font>
			<font color="#FF0000">{</font>
				result <font color="#990000">=</font> <b><font color="#000000">NewFactoryPresetSet</font></b><font color="#990000">(</font>newPreset<font color="#990000">);</font>
				<i><font color="#9A1900">// NewFactoryPresetSet SHOULD call SetAFactoryPreset if the preset is valid</font></i>
				<i><font color="#9A1900">// from its own list of preset number-&gt;name</font></i>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>result<font color="#990000">)</font>
					<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			<font color="#FF0000">}</font>
			<b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>newPreset<font color="#990000">.</font>presetName<font color="#990000">)</font>
			<font color="#FF0000">{</font>
				<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
				mCurrentPreset <font color="#990000">=</font> newPreset<font color="#990000">;</font>
				<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
				<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			<font color="#FF0000">}</font>
			<b><font color="#0000FF">else</font></b>
				result <font color="#990000">=</font> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ElementName<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)</font> <font color="#990000">!=</font> NULL<font color="#990000">,</font> InvalidElement<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFStringRef<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			AUElement <font color="#990000">*</font> element <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b><font color="#990000">(</font>inScope<font color="#990000">).</font><b><font color="#000000">GetElement</font></b> <font color="#990000">(</font>inElement<font color="#990000">);</font>
			element<font color="#990000">-&gt;</font><b><font color="#000000">SetName</font></b> <font color="#990000">(*(</font>CFStringRef <font color="#990000">*)</font>inData<font color="#990000">);</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

<b><font color="#000080">#if</font></b> <font color="#990000">(</font>MAC_OS_X_VERSION_MIN_REQUIRED <font color="#990000">&gt;</font> MAC_OS_X_VERSION_10_5<font color="#990000">)</font> <font color="#990000">||</font> TARGET_OS_IPHONE
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ShouldAllocateBuffer<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">((</font>inScope <font color="#990000">==</font> kAudioUnitScope_Input <font color="#990000">||</font> inScope <font color="#990000">==</font> kAudioUnitScope_Output<font color="#990000">),</font> InvalidScope<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)</font> <font color="#990000">!=</font> NULL<font color="#990000">,</font> InvalidElement<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(!</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">(),</font> Initialized<font color="#990000">);</font>

			AUIOElement <font color="#990000">*</font> element <font color="#990000">=</font> <b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
			element<font color="#990000">-&gt;</font><b><font color="#000000">SetWillAllocateBuffer</font></b><font color="#990000">(*(</font>UInt32 <font color="#990000">*)</font>inData <font color="#990000">!=</font> <font color="#993399">0</font><font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_SetExternalBuffer<font color="#990000">:</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">&gt;=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitExternalBuffer<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">(),</font> Uninitialized<font color="#990000">);</font>
		<font color="#FF0000">{</font>
			<font color="#008080">AudioUnitExternalBuffer</font> <font color="#990000">&amp;</font>buf <font color="#990000">=</font> <font color="#990000">*(</font>AudioUnitExternalBuffer<font color="#990000">*)</font>inData<font color="#990000">;</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">intptr_t</font></b><font color="#990000">(</font>buf<font color="#990000">.</font>buffer<font color="#990000">)</font> <font color="#990000">&amp;</font> <font color="#993399">0x0F</font><font color="#990000">)</font> result <font color="#990000">=</font> kAudio_ParamError<font color="#990000">;</font>
			<b><font color="#0000FF">else</font></b> <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Input<font color="#990000">)</font> <font color="#FF0000">{</font>
				<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
				input<font color="#990000">-&gt;</font><b><font color="#000000">UseExternalBuffer</font></b><font color="#990000">(</font>buf<font color="#990000">);</font>
			<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
				<font color="#008080">AUOutputElement</font> <font color="#990000">*</font>output <font color="#990000">=</font> <b><font color="#000000">GetOutput</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
				output<font color="#990000">-&gt;</font><b><font color="#000000">UseExternalBuffer</font></b><font color="#990000">(</font>buf<font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ContextName<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inDataSize <font color="#990000">==</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CFStringRef<font color="#990000">),</font> InvalidPropertyValue<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
			<font color="#008080">CFStringRef</font> inStr <font color="#990000">=</font> <font color="#990000">*(</font>CFStringRef <font color="#990000">*)</font>inData<font color="#990000">;</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mContextName<font color="#990000">)</font> <b><font color="#000000">CFRelease</font></b><font color="#990000">(</font>mContextName<font color="#990000">);</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inStr<font color="#990000">)</font> <b><font color="#000000">CFRetain</font></b><font color="#990000">(</font>inStr<font color="#990000">);</font>
			mContextName <font color="#990000">=</font> inStr<font color="#990000">;</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>

	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_HostCallbacks<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		<font color="#008080">UInt32</font> availSize <font color="#990000">=</font> <font color="#990000">(</font>inDataSize <font color="#990000">&lt;</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>mHostCallbackInfo<font color="#990000">)</font> <font color="#990000">?</font> inDataSize <font color="#990000">:</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>mHostCallbackInfo<font color="#990000">));</font>
		<font color="#009900">bool</font> hasChanged <font color="#990000">=</font> <font color="#990000">!</font><b><font color="#000000">memcmp</font></b> <font color="#990000">(&amp;</font>mHostCallbackInfo<font color="#990000">,</font> inData<font color="#990000">,</font> availSize<font color="#990000">);</font>
		<b><font color="#000000">memset</font></b> <font color="#990000">(&amp;</font>mHostCallbackInfo<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>mHostCallbackInfo<font color="#990000">));</font>
		<b><font color="#000000">memcpy</font></b> <font color="#990000">(&amp;</font>mHostCallbackInfo<font color="#990000">,</font> inData<font color="#990000">,</font> availSize<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>hasChanged<font color="#990000">)</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#000080">#endif</font></b> <i><font color="#9A1900">// !CA_NO_AU_UI_FEATURES</font></i>
	
<b><font color="#008080">	default:</font></b>
		result <font color="#990000">=</font> <b><font color="#000000">SetProperty</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> inData<font color="#990000">,</font> inDataSize<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<b><font color="#008080">NotWritable:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_PropertyNotWritable<font color="#990000">;</font>
<b><font color="#008080">InvalidFormat:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_FormatNotSupported<font color="#990000">;</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
<b><font color="#008080">Uninitialized:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_Uninitialized<font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#000080">#if</font></b> <font color="#990000">(</font>MAC_OS_X_VERSION_MIN_REQUIRED <font color="#990000">&gt;</font> MAC_OS_X_VERSION_10_5<font color="#990000">)</font> <font color="#990000">||</font> CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#008080">Initialized:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_Initialized<font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#008080">InvalidScope:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidScope<font color="#990000">;</font>
<b><font color="#008080">InvalidProperty:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<b><font color="#008080">InvalidPropertyValue:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
<b><font color="#008080">InvalidElement:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidElement<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DispatchRemovePropertyValue</font></b> <font color="#990000">(</font><font color="#008080">AudioUnitPropertyID</font>		inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inID<font color="#990000">)</font>
	<font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_AudioChannelLayout<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		result <font color="#990000">=</font> <b><font color="#000000">RemoveAudioChannelLayout</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_ContextName<font color="#990000">:</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mContextName<font color="#990000">)</font> <b><font color="#000000">CFRelease</font></b><font color="#990000">(</font>mContextName<font color="#990000">);</font>
		mContextName <font color="#990000">=</font> NULL<font color="#990000">;</font>
		result <font color="#990000">=</font> noErr<font color="#990000">;</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	
	<b><font color="#0000FF">case</font></b> kAudioUnitProperty_HostCallbacks<font color="#990000">:</font>
	<font color="#FF0000">{</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global<font color="#990000">,</font> InvalidScope<font color="#990000">);</font>
		<font color="#009900">bool</font> hasValue <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
		<font color="#009900">void</font><font color="#990000">*</font> ptr <font color="#990000">=</font> <font color="#990000">&amp;</font>mHostCallbackInfo<font color="#990000">;</font>
		<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> <font color="#009900">int</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font>  <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>HostCallbackInfo<font color="#990000">);</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font><font color="#009900">char</font><font color="#990000">*&gt;(</font>ptr<font color="#990000">)[</font>i<font color="#990000">])</font> <font color="#FF0000">{</font>
				hasValue <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>hasValue<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">memset</font></b> <font color="#990000">(&amp;</font>mHostCallbackInfo<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>HostCallbackInfo<font color="#990000">));</font>
			<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#000080">#endif</font></b> <i><font color="#9A1900">// !CA_NO_AU_UI_FEATURES	</font></i>

<b><font color="#008080">	default:</font></b>
		result <font color="#990000">=</font> <b><font color="#000000">RemovePropertyValue</font></b> <font color="#990000">(</font>inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>		
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
		
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
<b><font color="#008080">InvalidScope:</font></b>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidScope<font color="#990000">;</font>
<b><font color="#000080">#endif</font></b>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetPropertyInfo</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitPropertyID</font>				inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">,</font>
													UInt32 <font color="#990000">&amp;</font>						outDataSize<font color="#990000">,</font>
													Boolean <font color="#990000">&amp;</font>						outWritable<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>


<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetProperty</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitPropertyID</font> 			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>			 	inElement<font color="#990000">,</font>
													<font color="#009900">void</font> <font color="#990000">*</font>							outData<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>


<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SetProperty</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitPropertyID</font> 			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">,</font>
													<b><font color="#0000FF">const</font></b> <font color="#009900">void</font> <font color="#990000">*</font>					inData<font color="#990000">,</font>
													<font color="#008080">UInt32</font> 							inDataSize<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">RemovePropertyValue</font></b> <font color="#990000">(</font>	<font color="#008080">AudioUnitPropertyID</font>		 		inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
<font color="#FF0000">}</font>
												
<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">AddPropertyListener</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitPropertyID</font>				inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitPropertyListenerProc</font>	inProc<font color="#990000">,</font>
													<font color="#009900">void</font> <font color="#990000">*</font>							inProcRefCon<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">PropertyListener</font> pl<font color="#990000">;</font>
	
	pl<font color="#990000">.</font>propertyID <font color="#990000">=</font> inID<font color="#990000">;</font>
	pl<font color="#990000">.</font>listenerProc <font color="#990000">=</font> inProc<font color="#990000">;</font>
	pl<font color="#990000">.</font>listenerRefCon <font color="#990000">=</font> inProcRefCon<font color="#990000">;</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mPropertyListeners<font color="#990000">.</font><b><font color="#000000">empty</font></b><font color="#990000">())</font>
		mPropertyListeners<font color="#990000">.</font><b><font color="#000000">reserve</font></b><font color="#990000">(</font><font color="#993399">32</font><font color="#990000">);</font>
	mPropertyListeners<font color="#990000">.</font><b><font color="#000000">push_back</font></b><font color="#990000">(</font>pl<font color="#990000">);</font>

	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">RemovePropertyListener</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitPropertyID</font>				inID<font color="#990000">,</font>
														<font color="#008080">AudioUnitPropertyListenerProc</font>	inProc<font color="#990000">,</font>
														<font color="#009900">void</font> <font color="#990000">*</font>							inProcRefCon<font color="#990000">,</font>
														<font color="#009900">bool</font>							refConSpecified<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<i><font color="#9A1900">// iterate in reverse so that it's safe to erase in the middle of the vector</font></i>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">int</font> i <font color="#990000">=</font> mPropertyListeners<font color="#990000">.</font><b><font color="#000000">size</font></b><font color="#990000">();</font> <font color="#990000">--</font>i <font color="#990000">&gt;=</font><font color="#993399">0</font><font color="#990000">;</font> <font color="#990000">)</font> <font color="#FF0000">{</font>
		PropertyListeners<font color="#990000">::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> mPropertyListeners<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">()</font> <font color="#990000">+</font> i<font color="#990000">;</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">((*</font>it<font color="#990000">).</font>propertyID <font color="#990000">==</font> inID <font color="#990000">&amp;&amp;</font> <font color="#990000">(*</font>it<font color="#990000">).</font>listenerProc <font color="#990000">==</font> inProc <font color="#990000">&amp;&amp;</font> <font color="#990000">(!</font>refConSpecified <font color="#990000">||</font> <font color="#990000">(*</font>it<font color="#990000">).</font>listenerRefCon <font color="#990000">==</font> inProcRefCon<font color="#990000">))</font>
			mPropertyListeners<font color="#990000">.</font><b><font color="#000000">erase</font></b><font color="#990000">(</font>it<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitPropertyID</font>				inID<font color="#990000">,</font>
														<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font> 
														<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font>PropertyListeners<font color="#990000">::</font><font color="#008080">iterator</font> it <font color="#990000">=</font> mPropertyListeners<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> it <font color="#990000">!=</font> mPropertyListeners<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>it<font color="#990000">)</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">((*</font>it<font color="#990000">).</font>propertyID <font color="#990000">==</font> inID<font color="#990000">)</font>
			<font color="#990000">((*</font>it<font color="#990000">).</font>listenerProc<font color="#990000">)((*</font>it<font color="#990000">).</font>listenerRefCon<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> inID<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SetRenderNotification</font></b><font color="#990000">(</font>	<font color="#008080">AURenderCallback</font>		 		inProc<font color="#990000">,</font>
													<font color="#009900">void</font> <font color="#990000">*</font>							inRefCon<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inProc <font color="#990000">==</font> NULL<font color="#990000">)</font>
		<b><font color="#0000FF">return</font></b> kAudio_ParamError<font color="#990000">;</font>

	mRenderCallbacksTouched <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">deferred_add</font></b><font color="#990000">(</font><b><font color="#000000">RenderCallback</font></b><font color="#990000">(</font>inProc<font color="#990000">,</font> inRefCon<font color="#990000">));</font>
			<i><font color="#9A1900">// this will do nothing if it's already in the list</font></i>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">RemoveRenderNotification</font></b><font color="#990000">(</font>	<font color="#008080">AURenderCallback</font>			inProc<font color="#990000">,</font>
														<font color="#009900">void</font> <font color="#990000">*</font>						inRefCon<font color="#990000">)</font>
<font color="#FF0000">{</font>
	mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">deferred_remove</font></b><font color="#990000">(</font><b><font color="#000000">RenderCallback</font></b><font color="#990000">(</font>inProc<font color="#990000">,</font> inRefCon<font color="#990000">));</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>	<i><font color="#9A1900">// error?</font></i>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font> 	AUBase<font color="#990000">::</font><b><font color="#000000">GetParameter</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitParameterID</font>			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">,</font>
													AudioUnitParameterValue <font color="#990000">&amp;</font>		outValue<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">AUElement</font> <font color="#990000">*</font>elem <font color="#990000">=</font> <b><font color="#000000">SafeGetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
	outValue <font color="#990000">=</font> elem<font color="#990000">-&gt;</font><b><font color="#000000">GetParameter</font></b><font color="#990000">(</font>inID<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

											
<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font> 	AUBase<font color="#990000">::</font><b><font color="#000000">SetParameter</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitParameterID</font>			inID<font color="#990000">,</font>
													<font color="#008080">AudioUnitScope</font> 					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">,</font>
													<font color="#008080">AudioUnitParameterValue</font>			inValue<font color="#990000">,</font>
													<font color="#008080">UInt32</font>							inBufferOffsetInFrames<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">AUElement</font> <font color="#990000">*</font>elem <font color="#990000">=</font> <b><font color="#000000">SafeGetElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
	elem<font color="#990000">-&gt;</font><b><font color="#000000">SetParameter</font></b><font color="#990000">(</font>inID<font color="#990000">,</font> inValue<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font> 	AUBase<font color="#990000">::</font><b><font color="#000000">ScheduleParameter</font></b> <font color="#990000">(</font>	<b><font color="#0000FF">const</font></b> <font color="#008080">AudioUnitParameterEvent</font> 		<font color="#990000">*</font>inParameterEvent<font color="#990000">,</font>
													<font color="#008080">UInt32</font>							inNumEvents<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#008080">UInt32</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> inNumEvents<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> 
	<font color="#FF0000">{</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>eventType <font color="#990000">==</font> kParameterEvent_Immediate<font color="#990000">)</font>
		<font color="#FF0000">{</font>
			<b><font color="#000000">SetParameter</font></b> <font color="#990000">(</font>inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>parameter<font color="#990000">,</font>
							inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>scope<font color="#990000">,</font> 
							inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>element<font color="#990000">,</font>
							inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>value<font color="#990000">,</font> 
							inParameterEvent<font color="#990000">[</font>i<font color="#990000">].</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>bufferOffset<font color="#990000">);</font>
		<font color="#FF0000">}</font> 
		mParamList<font color="#990000">.</font><b><font color="#000000">push_back</font></b> <font color="#990000">(</font>inParameterEvent<font color="#990000">[</font>i<font color="#990000">]);</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">// ____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<b><font color="#0000FF">static</font></b> <font color="#009900">bool</font> <b><font color="#000000">SortParameterEventList</font></b><font color="#990000">(</font><b><font color="#0000FF">const</font></b> <font color="#008080">AudioUnitParameterEvent</font> <font color="#990000">&amp;</font>ev1<font color="#990000">,</font> <b><font color="#0000FF">const</font></b> <font color="#008080">AudioUnitParameterEvent</font> <font color="#990000">&amp;</font>ev2 <font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#009900">int</font> offset1 <font color="#990000">=</font> ev1<font color="#990000">.</font>eventType <font color="#990000">==</font> kParameterEvent_Immediate <font color="#990000">?</font>  ev1<font color="#990000">.</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>bufferOffset <font color="#990000">:</font> ev1<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset<font color="#990000">;</font>
	<font color="#009900">int</font> offset2 <font color="#990000">=</font> ev2<font color="#990000">.</font>eventType <font color="#990000">==</font> kParameterEvent_Immediate <font color="#990000">?</font>  ev2<font color="#990000">.</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>bufferOffset <font color="#990000">:</font> ev2<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset<font color="#990000">;</font>

	<b><font color="#0000FF">if</font></b><font color="#990000">(</font>offset1 <font color="#990000">&lt;</font> offset2<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>


<i><font color="#9A1900">// ____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font> 	AUBase<font color="#990000">::</font><b><font color="#000000">ProcessForScheduledParams</font></b><font color="#990000">(</font>	<font color="#008080">ParameterEventList</font>		<font color="#990000">&amp;</font>inParamList<font color="#990000">,</font>
														<font color="#008080">UInt32</font>					inFramesToProcess<font color="#990000">,</font>
														<font color="#009900">void</font>					<font color="#990000">*</font>inUserData <font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
	
	<font color="#009900">int</font> totalFramesToProcess <font color="#990000">=</font> inFramesToProcess<font color="#990000">;</font>
	
	<font color="#009900">int</font> framesRemaining <font color="#990000">=</font> totalFramesToProcess<font color="#990000">;</font>

	<font color="#009900">unsigned</font> <font color="#009900">int</font> currentStartFrame <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>	<i><font color="#9A1900">// start of the whole buffer</font></i>



	<i><font color="#9A1900">// sort the ParameterEventList by startBufferOffset</font></i>
	std<font color="#990000">::</font><b><font color="#000000">sort</font></b><font color="#990000">(</font>inParamList<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">(),</font> inParamList<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">(),</font> SortParameterEventList<font color="#990000">);</font>

	ParameterEventList<font color="#990000">::</font><font color="#008080">iterator</font> iter <font color="#990000">=</font> inParamList<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font>
	
	
	<b><font color="#0000FF">while</font></b><font color="#990000">(</font>framesRemaining <font color="#990000">&gt;</font> <font color="#993399">0</font> <font color="#990000">)</font>
	<font color="#FF0000">{</font>
		<i><font color="#9A1900">// first of all, go through the ramped automation events and find out where the next</font></i>
		<i><font color="#9A1900">// division of our whole buffer will be</font></i>
		
		<font color="#009900">int</font> currentEndFrame <font color="#990000">=</font> totalFramesToProcess<font color="#990000">;</font>	<i><font color="#9A1900">// start out assuming we'll process all the way to</font></i>
													<i><font color="#9A1900">// the end of the buffer</font></i>
		
		iter <font color="#990000">=</font> inParamList<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font>
		
		<i><font color="#9A1900">// find the next break point</font></i>
		<b><font color="#0000FF">while</font></b><font color="#990000">(</font>iter <font color="#990000">!=</font> inParamList<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">()</font> <font color="#990000">)</font>
		<font color="#FF0000">{</font>
			<font color="#008080">AudioUnitParameterEvent</font> <font color="#990000">&amp;</font>event <font color="#990000">=</font> <font color="#990000">*</font>iter<font color="#990000">;</font>
			
			<font color="#009900">int</font> offset <font color="#990000">=</font> event<font color="#990000">.</font>eventType <font color="#990000">==</font> kParameterEvent_Immediate <font color="#990000">?</font>  event<font color="#990000">.</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>bufferOffset <font color="#990000">:</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset<font color="#990000">;</font>

			<b><font color="#0000FF">if</font></b><font color="#990000">(</font>offset <font color="#990000">&gt;</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font>currentStartFrame <font color="#990000">&amp;&amp;</font> offset <font color="#990000">&lt;</font> currentEndFrame <font color="#990000">)</font>
			<font color="#FF0000">{</font>
				currentEndFrame <font color="#990000">=</font> offset<font color="#990000">;</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			<font color="#FF0000">}</font>

			<i><font color="#9A1900">// consider ramp end to be a possible choice (there may be gaps in the supplied ramp events)</font></i>
			<b><font color="#0000FF">if</font></b><font color="#990000">(</font>event<font color="#990000">.</font>eventType <font color="#990000">==</font> kParameterEvent_Ramped <font color="#990000">)</font>
			<font color="#FF0000">{</font>
				offset <font color="#990000">=</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset <font color="#990000">+</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>durationInFrames<font color="#990000">;</font>
	
				<b><font color="#0000FF">if</font></b><font color="#990000">(</font>offset <font color="#990000">&gt;</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font>currentStartFrame <font color="#990000">&amp;&amp;</font> offset <font color="#990000">&lt;</font> currentEndFrame <font color="#990000">)</font>
				<font color="#FF0000">{</font>
					currentEndFrame <font color="#990000">=</font> offset<font color="#990000">;</font>
				<font color="#FF0000">}</font>
			<font color="#FF0000">}</font>

			iter<font color="#990000">++;</font>
		<font color="#FF0000">}</font>
	
		<font color="#009900">int</font> framesThisTime <font color="#990000">=</font> currentEndFrame <font color="#990000">-</font> currentStartFrame<font color="#990000">;</font>

		<i><font color="#9A1900">// next, setup the parameter maps to be current for the ramp parameters active during </font></i>
		<i><font color="#9A1900">// this time segment...</font></i>
		
		<b><font color="#0000FF">for</font></b><font color="#990000">(</font>ParameterEventList<font color="#990000">::</font><font color="#008080">iterator</font> iter2 <font color="#990000">=</font> inParamList<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> iter2 <font color="#990000">!=</font> inParamList<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> iter2<font color="#990000">++</font> <font color="#990000">)</font>
		<font color="#FF0000">{</font>
			<font color="#008080">AudioUnitParameterEvent</font> <font color="#990000">&amp;</font>event <font color="#990000">=</font> <font color="#990000">*</font>iter2<font color="#990000">;</font>
			
			<font color="#009900">bool</font> eventFallsInSlice<font color="#990000">;</font>
			
			
			<b><font color="#0000FF">if</font></b><font color="#990000">(</font>event<font color="#990000">.</font>eventType <font color="#990000">==</font> kParameterEvent_Ramped<font color="#990000">)</font>
				eventFallsInSlice <font color="#990000">=</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset <font color="#990000">&lt;</font> currentEndFrame 
					<font color="#990000">&amp;&amp;</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>startBufferOffset <font color="#990000">+</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>ramp<font color="#990000">.</font>durationInFrames <font color="#990000">&gt;</font> currentStartFrame<font color="#990000">;</font>
			<b><font color="#0000FF">else</font></b> <i><font color="#9A1900">/* kParameterEvent_Immediate */</font></i>
				<i><font color="#9A1900">// actually, for the same parameter, there may be future immediate events which override this one,</font></i>
				<i><font color="#9A1900">// but it's OK since the event list is sorted in time order, we're guaranteed to end up with the current one</font></i>
				eventFallsInSlice <font color="#990000">=</font> event<font color="#990000">.</font>eventValues<font color="#990000">.</font>immediate<font color="#990000">.</font>bufferOffset <font color="#990000">&lt;=</font> currentStartFrame<font color="#990000">;</font>
				
			<b><font color="#0000FF">if</font></b><font color="#990000">(</font>eventFallsInSlice<font color="#990000">)</font>
			<font color="#FF0000">{</font>
				<font color="#008080">AUElement</font> <font color="#990000">*</font>element <font color="#990000">=</font> <b><font color="#000000">GetElement</font></b><font color="#990000">(</font>event<font color="#990000">.</font>scope<font color="#990000">,</font> event<font color="#990000">.</font>element <font color="#990000">);</font>
				
				<b><font color="#0000FF">if</font></b><font color="#990000">(</font>element<font color="#990000">)</font> element<font color="#990000">-&gt;</font><b><font color="#000000">SetScheduledEvent</font></b><font color="#990000">(</font>	event<font color="#990000">.</font>parameter<font color="#990000">,</font>
														event<font color="#990000">,</font>
														currentStartFrame<font color="#990000">,</font>
														currentEndFrame <font color="#990000">-</font> currentStartFrame <font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>



		<i><font color="#9A1900">// Finally, actually do the processing for this slice.....</font></i>
		
		result <font color="#990000">=</font> <b><font color="#000000">ProcessScheduledSlice</font></b><font color="#990000">(</font>	inUserData<font color="#990000">,</font>
										currentStartFrame<font color="#990000">,</font>
										framesThisTime<font color="#990000">,</font>
										inFramesToProcess <font color="#990000">);</font>
								
		<b><font color="#0000FF">if</font></b><font color="#990000">(</font>result <font color="#990000">!=</font> noErr<font color="#990000">)</font> <b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		
		framesRemaining <font color="#990000">-=</font> framesThisTime<font color="#990000">;</font>
		currentStartFrame <font color="#990000">=</font> currentEndFrame<font color="#990000">;</font>	<i><font color="#9A1900">// now start from where we left off last time</font></i>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">SetWantsRenderThreadID</font></b> <font color="#990000">(</font><font color="#009900">bool</font> inFlag<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inFlag <font color="#990000">==</font> mWantsRenderThreadID<font color="#990000">)</font>	
		<b><font color="#0000FF">return</font></b><font color="#990000">;</font>
	
	mWantsRenderThreadID <font color="#990000">=</font> inFlag<font color="#990000">;</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>mWantsRenderThreadID<font color="#990000">)</font>
		mRenderThreadID <font color="#990000">=</font> NULL<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">DoRender</font></b><font color="#990000">(</font>		AudioUnitRenderActionFlags <font color="#990000">&amp;</font>	ioActionFlags<font color="#990000">,</font>
											<b><font color="#0000FF">const</font></b> AudioTimeStamp <font color="#990000">&amp;</font>			inTimeStamp<font color="#990000">,</font>
											<font color="#008080">UInt32</font>							inBusNumber<font color="#990000">,</font>
											<font color="#008080">UInt32</font>							inFramesToProcess<font color="#990000">,</font>
											AudioBufferList <font color="#990000">&amp;</font>				ioData<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> theError<font color="#990000">;</font>
	RenderCallbackList<font color="#990000">::</font><font color="#008080">iterator</font> rcit<font color="#990000">;</font>
	
	<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderStart<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> inBusNumber<font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
	DISABLE_DENORMALS
	
	<b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">(),</font> Uninitialized<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>mAudioUnitAPIVersion <font color="#990000">&gt;=</font> <font color="#993399">2</font><font color="#990000">,</font> ParamErr<font color="#990000">);</font>
		<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inFramesToProcess <font color="#990000">&lt;=</font> mMaxFramesPerSlice<font color="#990000">,</font> TooManyFrames<font color="#990000">);</font>
		
		<font color="#008080">AUOutputElement</font> <font color="#990000">*</font>output <font color="#990000">=</font> <b><font color="#000000">GetOutput</font></b><font color="#990000">(</font>inBusNumber<font color="#990000">);</font>	<i><font color="#9A1900">// will throw if non-existant</font></i>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">()</font> <font color="#990000">!=</font> ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">DebugMessageN4</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d ioData.mNumberBuffers=%u, output-&gt;GetStreamFormat().NumberChannelStreams()=%u; kAudio_ParamError"</font><font color="#990000">,</font>
				__FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">());</font>
			<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
		<font color="#FF0000">}</font>

		<font color="#009900">unsigned</font> expectedBufferByteSize <font color="#990000">=</font> inFramesToProcess <font color="#990000">*</font> output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">;</font>
		<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> ibuf <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ibuf <font color="#990000">&lt;</font> ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">;</font> <font color="#990000">++</font>ibuf<font color="#990000">)</font> <font color="#FF0000">{</font>
			<font color="#008080">AudioBuffer</font> <font color="#990000">&amp;</font>buf <font color="#990000">=</font> ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font>ibuf<font color="#990000">];</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mData <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
				<i><font color="#9A1900">// only care about the size if the buffer is non-null</font></i>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mDataByteSize <font color="#990000">&lt;</font> expectedBufferByteSize<font color="#990000">)</font> <font color="#FF0000">{</font>
					<i><font color="#9A1900">// if the buffer is too small, we cannot render safely. kAudio_ParamError.</font></i>
					<b><font color="#000000">DebugMessageN7</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d %u frames, %u bytes/frame, expected %u-byte buffer; ioData.mBuffers[%u].mDataByteSize=%u; kAudio_ParamError"</font><font color="#990000">,</font>
						__FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>inFramesToProcess<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">,</font> expectedBufferByteSize<font color="#990000">,</font> ibuf<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>buf<font color="#990000">.</font>mDataByteSize<font color="#990000">);</font>
					<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
				<font color="#FF0000">}</font>
				<i><font color="#9A1900">// Some clients incorrectly pass bigger buffers than expectedBufferByteSize.</font></i>
				<i><font color="#9A1900">// We will generally set the buffer size at the end of rendering, before we return.</font></i>
				<i><font color="#9A1900">// However we should ensure that no one, DURING rendering, READS a</font></i>
				<i><font color="#9A1900">// potentially incorrect size. This can lead to doing too much work, or</font></i>
				<i><font color="#9A1900">// reading past the end of an input buffer into unmapped memory.</font></i>
				buf<font color="#990000">.</font>mDataByteSize <font color="#990000">=</font> expectedBufferByteSize<font color="#990000">;</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">WantsRenderThreadID</font></b><font color="#990000">())</font>
		<font color="#FF0000">{</font>
<b><font color="#000080">			#if</font></b> TARGET_OS_MAC
				mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">pthread_self</font></b><font color="#990000">();</font>
<b><font color="#000080">			#elif</font></b> TARGET_OS_WIN32
				mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">GetCurrentThreadId</font></b><font color="#990000">();</font>
<b><font color="#000080">			#endif</font></b>
		<font color="#FF0000">}</font>
		
		<font color="#008080">AudioUnitRenderActionFlags</font> flags<font color="#990000">;</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mRenderCallbacksTouched<font color="#990000">)</font> <font color="#FF0000">{</font>
			mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">update</font></b><font color="#990000">();</font>
			flags <font color="#990000">=</font> ioActionFlags <font color="#990000">|</font> kAudioUnitRenderAction_PreRender<font color="#990000">;</font>
			<b><font color="#0000FF">for</font></b> <font color="#990000">(</font>rcit <font color="#990000">=</font> mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> rcit <font color="#990000">!=</font> mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>rcit<font color="#990000">)</font> <font color="#FF0000">{</font>
				<font color="#008080">RenderCallback</font> <font color="#990000">&amp;</font>rc <font color="#990000">=</font> <font color="#990000">*</font>rcit<font color="#990000">;</font>
				<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderCallbackStart<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
				<font color="#990000">(*(</font>AURenderCallback<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">)(</font>rc<font color="#990000">.</font>mRenderNotifyRefCon<font color="#990000">,</font> 
								<font color="#990000">&amp;</font>flags<font color="#990000">,</font>
								<font color="#990000">&amp;</font>inTimeStamp<font color="#990000">,</font> inBusNumber<font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> <font color="#990000">&amp;</font>ioData<font color="#990000">);</font>
				<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderCallbackEnd<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">,</font> <font color="#993399">1</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		
		theError <font color="#990000">=</font> <b><font color="#000000">DoRenderBus</font></b><font color="#990000">(</font>ioActionFlags<font color="#990000">,</font> inTimeStamp<font color="#990000">,</font> inBusNumber<font color="#990000">,</font> output<font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> ioData<font color="#990000">);</font>
		
		flags <font color="#990000">=</font> ioActionFlags <font color="#990000">|</font> kAudioUnitRenderAction_PostRender<font color="#990000">;</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">SetRenderError</font></b> <font color="#990000">(</font>theError<font color="#990000">))</font> <font color="#FF0000">{</font>
			flags <font color="#990000">|=</font> kAudioUnitRenderAction_PostRenderError<font color="#990000">;</font>		
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mRenderCallbacksTouched<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#0000FF">for</font></b> <font color="#990000">(</font>rcit <font color="#990000">=</font> mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">begin</font></b><font color="#990000">();</font> rcit <font color="#990000">!=</font> mRenderCallbacks<font color="#990000">.</font><b><font color="#000000">end</font></b><font color="#990000">();</font> <font color="#990000">++</font>rcit<font color="#990000">)</font> <font color="#FF0000">{</font>
				<font color="#008080">RenderCallback</font> <font color="#990000">&amp;</font>rc <font color="#990000">=</font> <font color="#990000">*</font>rcit<font color="#990000">;</font>
				<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderCallbackStart<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">,</font> <font color="#993399">2</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
				<font color="#990000">(*(</font>AURenderCallback<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">)(</font>rc<font color="#990000">.</font>mRenderNotifyRefCon<font color="#990000">,</font> 
								<font color="#990000">&amp;</font>flags<font color="#990000">,</font>
								<font color="#990000">&amp;</font>inTimeStamp<font color="#990000">,</font> inBusNumber<font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> <font color="#990000">&amp;</font>ioData<font color="#990000">);</font>
				<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderCallbackEnd<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font>rc<font color="#990000">.</font>mRenderNotify<font color="#990000">,</font> <font color="#993399">2</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>

		<i><font color="#9A1900">// The vector's being emptied</font></i>
		<i><font color="#9A1900">// because these events should only apply to this Render cycle, so anything</font></i>
		<i><font color="#9A1900">// left over is from a preceding cycle and should be dumped.  New scheduled</font></i>
		<i><font color="#9A1900">// parameters must be scheduled from the next pre-render callback.</font></i>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>mParamList<font color="#990000">.</font><b><font color="#000000">empty</font></b><font color="#990000">())</font>
			mParamList<font color="#990000">.</font><b><font color="#000000">clear</font></b><font color="#990000">();</font>

	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><font color="#008080">OSStatus</font> err<font color="#990000">)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> err<font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(...)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#008080">done:	</font></b>
	RESTORE_DENORMALS
	<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderEnd<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> theError<font color="#990000">,</font> ioActionFlags<font color="#990000">,</font> ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">].</font>mData <font color="#990000">!=</font> NULL <font color="#990000">?</font> <font color="#990000">*(</font>int64_t <font color="#990000">*)</font>ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">].</font>mData <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
	
	<b><font color="#0000FF">return</font></b> theError<font color="#990000">;</font>
	
Uninitialized<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_Uninitialized<font color="#990000">;</font>				<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
ParamErr<font color="#990000">:</font>		theError <font color="#990000">=</font> kAudio_ParamError<font color="#990000">;</font>						<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
TooManyFrames<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_TooManyFramesToProcess<font color="#990000">;</font>	<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
<b><font color="#008080">errexit:</font></b>
	<b><font color="#000000">DebugMessageN2</font></b> <font color="#990000">(</font><font color="#FF0000">"  from %s, render err: %d"</font><font color="#990000">,</font> <b><font color="#000000">GetLoggingString</font></b><font color="#990000">(),</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font>theError<font color="#990000">);</font>
	<b><font color="#000000">SetRenderError</font></b><font color="#990000">(</font>theError<font color="#990000">);</font>
	<b><font color="#0000FF">goto</font></b> done<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>	AUBase<font color="#990000">::</font><b><font color="#000000">DoProcess</font></b> <font color="#990000">(</font>	AudioUnitRenderActionFlags  <font color="#990000">&amp;</font>		ioActionFlags<font color="#990000">,</font>
								<b><font color="#0000FF">const</font></b> AudioTimeStamp <font color="#990000">&amp;</font>				inTimeStamp<font color="#990000">,</font>
								<font color="#008080">UInt32</font>								inFramesToProcess<font color="#990000">,</font>
								AudioBufferList <font color="#990000">&amp;</font>					ioData<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> theError<font color="#990000">;</font>
	<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderStart<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
	DISABLE_DENORMALS

	<b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!(</font>ioActionFlags <font color="#990000">&amp;</font> <font color="#990000">(</font><font color="#993399">1</font> <font color="#990000">&lt;&lt;</font> <font color="#993399">9</font><font color="#990000">)</font><i><font color="#9A1900">/*kAudioUnitRenderAction_DoNotCheckRenderArgs*/</font></i><font color="#990000">))</font> <font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">(),</font> Uninitialized<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inFramesToProcess <font color="#990000">&lt;=</font> mMaxFramesPerSlice<font color="#990000">,</font> TooManyFrames<font color="#990000">);</font>

			<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">);</font>	<i><font color="#9A1900">// will throw if non-existant</font></i>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">()</font> <font color="#990000">!=</font> ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#000000">DebugMessageN4</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d ioData.mNumberBuffers=%u, input-&gt;GetStreamFormat().NumberChannelStreams()=%u; kAudio_ParamError"</font><font color="#990000">,</font>
					__FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">());</font>
				<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
			<font color="#FF0000">}</font>

			<font color="#009900">unsigned</font> expectedBufferByteSize <font color="#990000">=</font> inFramesToProcess <font color="#990000">*</font> input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">;</font>
			<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> ibuf <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ibuf <font color="#990000">&lt;</font> ioData<font color="#990000">.</font>mNumberBuffers<font color="#990000">;</font> <font color="#990000">++</font>ibuf<font color="#990000">)</font> <font color="#FF0000">{</font>
				<font color="#008080">AudioBuffer</font> <font color="#990000">&amp;</font>buf <font color="#990000">=</font> ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font>ibuf<font color="#990000">];</font>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mData <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
					<i><font color="#9A1900">// only care about the size if the buffer is non-null</font></i>
					<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mDataByteSize <font color="#990000">&lt;</font> expectedBufferByteSize<font color="#990000">)</font> <font color="#FF0000">{</font>
						<i><font color="#9A1900">// if the buffer is too small, we cannot render safely. kAudio_ParamError.</font></i>
						<b><font color="#000000">DebugMessageN7</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d %u frames, %u bytes/frame, expected %u-byte buffer; ioData.mBuffers[%u].mDataByteSize=%u; kAudio_ParamError"</font><font color="#990000">,</font>
							__FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>inFramesToProcess<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">,</font> expectedBufferByteSize<font color="#990000">,</font> ibuf<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>buf<font color="#990000">.</font>mDataByteSize<font color="#990000">);</font>
						<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
					<font color="#FF0000">}</font>
					<i><font color="#9A1900">// Some clients incorrectly pass bigger buffers than expectedBufferByteSize.</font></i>
					<i><font color="#9A1900">// We will generally set the buffer size at the end of rendering, before we return.</font></i>
					<i><font color="#9A1900">// However we should ensure that no one, DURING rendering, READS a</font></i>
					<i><font color="#9A1900">// potentially incorrect size. This can lead to doing too much work, or</font></i>
					<i><font color="#9A1900">// reading past the end of an input buffer into unmapped memory.</font></i>
					buf<font color="#990000">.</font>mDataByteSize <font color="#990000">=</font> expectedBufferByteSize<font color="#990000">;</font>
				<font color="#FF0000">}</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">WantsRenderThreadID</font></b><font color="#990000">())</font>
		<font color="#FF0000">{</font>
<b><font color="#000080">			#if</font></b> TARGET_OS_MAC
				mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">pthread_self</font></b><font color="#990000">();</font>
<b><font color="#000080">			#elif</font></b> TARGET_OS_WIN32
				mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">GetCurrentThreadId</font></b><font color="#990000">();</font>
<b><font color="#000080">			#endif</font></b>
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">NeedsToRender</font></b> <font color="#990000">(</font>inTimeStamp<font color="#990000">))</font> <font color="#FF0000">{</font>
			theError <font color="#990000">=</font> <b><font color="#000000">ProcessBufferLists</font></b> <font color="#990000">(</font>ioActionFlags<font color="#990000">,</font> ioData<font color="#990000">,</font> ioData<font color="#990000">,</font> inFramesToProcess<font color="#990000">);</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
			theError <font color="#990000">=</font> noErr<font color="#990000">;</font>
			
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><font color="#008080">OSStatus</font> err<font color="#990000">)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> err<font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(...)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#008080">done:	</font></b>
	RESTORE_DENORMALS
	<b><font color="#000000">AUTRACE</font></b><font color="#990000">(</font>kCATrace_AUBaseRenderEnd<font color="#990000">,</font> mComponentInstance<font color="#990000">,</font> <font color="#990000">(</font>intptr_t<font color="#990000">)</font><b><font color="#0000FF">this</font></b><font color="#990000">,</font> theError<font color="#990000">,</font> ioActionFlags<font color="#990000">,</font> ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">].</font>mData <font color="#990000">!=</font> NULL <font color="#990000">?</font> <font color="#990000">*(</font>int64_t <font color="#990000">*)</font>ioData<font color="#990000">.</font>mBuffers<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">].</font>mData <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
	
	<b><font color="#0000FF">return</font></b> theError<font color="#990000">;</font>
	
Uninitialized<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_Uninitialized<font color="#990000">;</font>				<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
ParamErr<font color="#990000">:</font>		theError <font color="#990000">=</font> kAudio_ParamError<font color="#990000">;</font>						<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
TooManyFrames<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_TooManyFramesToProcess<font color="#990000">;</font>	<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
<b><font color="#008080">errexit:</font></b>
	<b><font color="#000000">DebugMessageN2</font></b> <font color="#990000">(</font><font color="#FF0000">"  from %s, process err: %d"</font><font color="#990000">,</font> <b><font color="#000000">GetLoggingString</font></b><font color="#990000">(),</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font>theError<font color="#990000">);</font>
	<b><font color="#000000">SetRenderError</font></b><font color="#990000">(</font>theError<font color="#990000">);</font>
	<b><font color="#0000FF">goto</font></b> done<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font>	AUBase<font color="#990000">::</font><b><font color="#000000">DoProcessMultiple</font></b> <font color="#990000">(</font>	AudioUnitRenderActionFlags  <font color="#990000">&amp;</font> ioActionFlags<font color="#990000">,</font>
							   <b><font color="#0000FF">const</font></b> AudioTimeStamp <font color="#990000">&amp;</font>				inTimeStamp<font color="#990000">,</font>
							   <font color="#008080">UInt32</font>								inFramesToProcess<font color="#990000">,</font>
							   <font color="#008080">UInt32</font>								inNumberInputBufferLists<font color="#990000">,</font>
							   <b><font color="#0000FF">const</font></b> AudioBufferList <font color="#990000">**</font>				inInputBufferLists<font color="#990000">,</font>
							   <font color="#008080">UInt32</font>								inNumberOutputBufferLists<font color="#990000">,</font>
							   AudioBufferList <font color="#990000">**</font>					ioOutputBufferLists<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> theError<font color="#990000">;</font>
	DISABLE_DENORMALS
	
	<b><font color="#0000FF">try</font></b> <font color="#FF0000">{</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(!(</font>ioActionFlags <font color="#990000">&amp;</font> <font color="#990000">(</font><font color="#993399">1</font> <font color="#990000">&lt;&lt;</font> <font color="#993399">9</font><font color="#990000">)</font><i><font color="#9A1900">/*kAudioUnitRenderAction_DoNotCheckRenderArgs*/</font></i><font color="#990000">))</font> <font color="#FF0000">{</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">(),</font> Uninitialized<font color="#990000">);</font>
			<b><font color="#000000">ca_require</font></b><font color="#990000">(</font>inFramesToProcess <font color="#990000">&lt;=</font> mMaxFramesPerSlice<font color="#990000">,</font> TooManyFrames<font color="#990000">);</font>
			
			<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> ibl <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ibl <font color="#990000">&lt;</font> inNumberInputBufferLists<font color="#990000">;</font> <font color="#990000">++</font>ibl<font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inInputBufferLists<font color="#990000">[</font>ibl<font color="#990000">]</font> <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
					<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>ibl<font color="#990000">);</font>	<i><font color="#9A1900">// will throw if non-existant</font></i>
					<font color="#009900">unsigned</font> expectedBufferByteSize <font color="#990000">=</font> inFramesToProcess <font color="#990000">*</font> input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">;</font>
					
					<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">()</font> <font color="#990000">!=</font> inInputBufferLists<font color="#990000">[</font>ibl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">)</font> <font color="#FF0000">{</font>
						<b><font color="#000000">DebugMessageN5</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d inInputBufferLists[%u]-&gt;mNumberBuffers=%u, input-&gt;GetStreamFormat().NumberChannelStreams()=%u; kAudio_ParamError"</font><font color="#990000">,</font>
									   __FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> ibl<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>inInputBufferLists<font color="#990000">[</font>ibl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">());</font>
						<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
					<font color="#FF0000">}</font>
					
					<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> ibuf <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ibuf <font color="#990000">&lt;</font> inInputBufferLists<font color="#990000">[</font>ibl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">;</font> <font color="#990000">++</font>ibuf<font color="#990000">)</font> <font color="#FF0000">{</font>
						<b><font color="#0000FF">const</font></b> <font color="#008080">AudioBuffer</font> <font color="#990000">&amp;</font>buf <font color="#990000">=</font> inInputBufferLists<font color="#990000">[</font>ibl<font color="#990000">]-&gt;</font>mBuffers<font color="#990000">[</font>ibuf<font color="#990000">];</font>
						<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mData <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
							<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mDataByteSize <font color="#990000">&lt;</font> expectedBufferByteSize<font color="#990000">)</font> <font color="#FF0000">{</font>
								<i><font color="#9A1900">// the buffer is too small</font></i>
								<b><font color="#000000">DebugMessageN8</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d %u frames, %u bytes/frame, expected %u-byte buffer; inInputBufferLists[%u].mBuffers[%u].mDataByteSize=%u; kAudio_ParamError"</font><font color="#990000">,</font>
											   __FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>inFramesToProcess<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>input<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">,</font> expectedBufferByteSize<font color="#990000">,</font> ibl<font color="#990000">,</font> ibuf<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>buf<font color="#990000">.</font>mDataByteSize<font color="#990000">);</font>
								<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
							<font color="#FF0000">}</font>
						<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
							<i><font color="#9A1900">// the buffer must exist</font></i>
							<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
						<font color="#FF0000">}</font>
					<font color="#FF0000">}</font>
				<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
					<i><font color="#9A1900">// skip NULL input audio buffer list</font></i>
				<font color="#FF0000">}</font>
			<font color="#FF0000">}</font>
			
			<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> obl <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> obl <font color="#990000">&lt;</font> inNumberOutputBufferLists<font color="#990000">;</font> <font color="#990000">++</font>obl<font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>ioOutputBufferLists<font color="#990000">[</font>obl<font color="#990000">]</font> <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
					<font color="#008080">AUOutputElement</font> <font color="#990000">*</font>output <font color="#990000">=</font> <b><font color="#000000">GetOutput</font></b><font color="#990000">(</font>obl<font color="#990000">);</font>	<i><font color="#9A1900">// will throw if non-existant</font></i>
					<font color="#009900">unsigned</font> expectedBufferByteSize <font color="#990000">=</font> inFramesToProcess <font color="#990000">*</font> output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">;</font>

					<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">()</font> <font color="#990000">!=</font> ioOutputBufferLists<font color="#990000">[</font>obl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">)</font> <font color="#FF0000">{</font>
						<b><font color="#000000">DebugMessageN5</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d ioOutputBufferLists[%u]-&gt;mNumberBuffers=%u, output-&gt;GetStreamFormat().NumberChannelStreams()=%u; kAudio_ParamError"</font><font color="#990000">,</font>
									   __FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> obl<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>ioOutputBufferLists<font color="#990000">[</font>obl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannelStreams</font></b><font color="#990000">());</font>
						<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
					<font color="#FF0000">}</font>
					
					<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> obuf <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> obuf <font color="#990000">&lt;</font> ioOutputBufferLists<font color="#990000">[</font>obl<font color="#990000">]-&gt;</font>mNumberBuffers<font color="#990000">;</font> <font color="#990000">++</font>obuf<font color="#990000">)</font> <font color="#FF0000">{</font>
						<font color="#008080">AudioBuffer</font> <font color="#990000">&amp;</font>buf <font color="#990000">=</font> ioOutputBufferLists<font color="#990000">[</font>obl<font color="#990000">]-&gt;</font>mBuffers<font color="#990000">[</font>obuf<font color="#990000">];</font>
						<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mData <font color="#990000">!=</font> NULL<font color="#990000">)</font> <font color="#FF0000">{</font>
							<i><font color="#9A1900">// only care about the size if the buffer is non-null</font></i>
							<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>buf<font color="#990000">.</font>mDataByteSize <font color="#990000">&lt;</font> expectedBufferByteSize<font color="#990000">)</font> <font color="#FF0000">{</font>
								<i><font color="#9A1900">// if the buffer is too small, we cannot render safely. kAudio_ParamError.</font></i>
								<b><font color="#000000">DebugMessageN8</font></b><font color="#990000">(</font><font color="#FF0000">"%s:%d %u frames, %u bytes/frame, expected %u-byte buffer; ioOutputBufferLists[%u]-&gt;mBuffers[%u].mDataByteSize=%u; kAudio_ParamError"</font><font color="#990000">,</font>
											   __FILE__<font color="#990000">,</font> __LINE__<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>inFramesToProcess<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>output<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font>mBytesPerFrame<font color="#990000">,</font> expectedBufferByteSize<font color="#990000">,</font> obl<font color="#990000">,</font> obuf<font color="#990000">,</font> <font color="#990000">(</font><font color="#009900">unsigned</font><font color="#990000">)</font>buf<font color="#990000">.</font>mDataByteSize<font color="#990000">);</font>
								<b><font color="#0000FF">goto</font></b> ParamErr<font color="#990000">;</font>
							<font color="#FF0000">}</font>
							<i><font color="#9A1900">// Some clients incorrectly pass bigger buffers than expectedBufferByteSize.</font></i>
							<i><font color="#9A1900">// We will generally set the buffer size at the end of rendering, before we return.</font></i>
							<i><font color="#9A1900">// However we should ensure that no one, DURING rendering, READS a</font></i>
							<i><font color="#9A1900">// potentially incorrect size. This can lead to doing too much work, or</font></i>
							<i><font color="#9A1900">// reading past the end of an input buffer into unmapped memory.</font></i>
							buf<font color="#990000">.</font>mDataByteSize <font color="#990000">=</font> expectedBufferByteSize<font color="#990000">;</font>
						<font color="#FF0000">}</font>
					<font color="#FF0000">}</font>
				<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
					<i><font color="#9A1900">// skip NULL output audio buffer list</font></i>
				<font color="#FF0000">}</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">WantsRenderThreadID</font></b><font color="#990000">())</font>
		<font color="#FF0000">{</font>
<b><font color="#000080">#if</font></b> TARGET_OS_MAC
			mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">pthread_self</font></b><font color="#990000">();</font>
<b><font color="#000080">#elif</font></b> TARGET_OS_WIN32
			mRenderThreadID <font color="#990000">=</font> <b><font color="#000000">GetCurrentThreadId</font></b><font color="#990000">();</font>
<b><font color="#000080">#endif</font></b>
		<font color="#FF0000">}</font>
		
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">NeedsToRender</font></b> <font color="#990000">(</font>inTimeStamp<font color="#990000">))</font> <font color="#FF0000">{</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inNumberInputBufferLists <font color="#990000">==</font> <font color="#993399">1</font> <font color="#990000">&amp;&amp;</font> inNumberOutputBufferLists <font color="#990000">==</font> <font color="#993399">1</font><font color="#990000">)</font>
				theError <font color="#990000">=</font> <b><font color="#000000">ProcessBufferLists</font></b> <font color="#990000">(</font>ioActionFlags<font color="#990000">,</font> <font color="#990000">*</font>inInputBufferLists<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font> <font color="#990000">*</font>ioOutputBufferLists<font color="#990000">[</font><font color="#993399">0</font><font color="#990000">],</font> inFramesToProcess<font color="#990000">);</font>
			<b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font>
				theError <font color="#990000">=</font> <b><font color="#000000">ProcessMultipleBufferLists</font></b> <font color="#990000">(</font>ioActionFlags<font color="#990000">,</font> inFramesToProcess<font color="#990000">,</font> inNumberInputBufferLists<font color="#990000">,</font> inInputBufferLists<font color="#990000">,</font> inNumberOutputBufferLists<font color="#990000">,</font> ioOutputBufferLists<font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font> <b><font color="#0000FF">else</font></b>
			theError <font color="#990000">=</font> noErr<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(</font><font color="#008080">OSStatus</font> err<font color="#990000">)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> err<font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">catch</font></b> <font color="#990000">(...)</font> <font color="#FF0000">{</font>
		theError <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
		<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#008080">done:	</font></b>
	RESTORE_DENORMALS
	
	<b><font color="#0000FF">return</font></b> theError<font color="#990000">;</font>
	
Uninitialized<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_Uninitialized<font color="#990000">;</font>				<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
ParamErr<font color="#990000">:</font>		theError <font color="#990000">=</font> kAudio_ParamError<font color="#990000">;</font>						<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
TooManyFrames<font color="#990000">:</font>	theError <font color="#990000">=</font> kAudioUnitErr_TooManyFramesToProcess<font color="#990000">;</font>	<b><font color="#0000FF">goto</font></b> errexit<font color="#990000">;</font>
<b><font color="#008080">errexit:</font></b>
	<b><font color="#000000">DebugMessageN2</font></b> <font color="#990000">(</font><font color="#FF0000">"  from %s, processmultiple err: %d"</font><font color="#990000">,</font> <b><font color="#000000">GetLoggingString</font></b><font color="#990000">(),</font> <font color="#990000">(</font><font color="#009900">int</font><font color="#990000">)</font>theError<font color="#990000">);</font>
	<b><font color="#000000">SetRenderError</font></b><font color="#990000">(</font>theError<font color="#990000">);</font>
	<b><font color="#0000FF">goto</font></b> done<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SetInputCallback</font></b><font color="#990000">(</font>		<font color="#008080">UInt32</font>							inPropertyID<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font> 				inElement<font color="#990000">,</font> 
													<font color="#008080">AURenderCallback</font>				inProc<font color="#990000">,</font>
													<font color="#009900">void</font> <font color="#990000">*</font>							inRefCon<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>	<i><font color="#9A1900">// may throw</font></i>
	
	input<font color="#990000">-&gt;</font><b><font color="#000000">SetInputCallback</font></b><font color="#990000">(</font>inProc<font color="#990000">,</font> inRefCon<font color="#990000">);</font>
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>inPropertyID<font color="#990000">,</font> kAudioUnitScope_Input<font color="#990000">,</font> inElement<font color="#990000">);</font>
	
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SetConnection</font></b><font color="#990000">(</font>			<b><font color="#0000FF">const</font></b> AudioUnitConnection <font color="#990000">&amp;</font>		inConnection<font color="#990000">)</font>
<font color="#FF0000">{</font>

	<font color="#008080">OSStatus</font> err<font color="#990000">;</font>
	<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>inConnection<font color="#990000">.</font>destInputNumber<font color="#990000">);</font>	<i><font color="#9A1900">// may throw</font></i>
		
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inConnection<font color="#990000">.</font>sourceAudioUnit<font color="#990000">)</font> <font color="#FF0000">{</font>
		<i><font color="#9A1900">// connecting, not disconnecting</font></i>
		<font color="#008080">CAStreamBasicDescription</font> sourceDesc<font color="#990000">;</font>
		<font color="#008080">UInt32</font> size <font color="#990000">=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CAStreamBasicDescription<font color="#990000">);</font>
		<b><font color="#000000">ca_require_noerr</font></b><font color="#990000">(</font>err <font color="#990000">=</font> <b><font color="#000000">AudioUnitGetProperty</font></b><font color="#990000">(</font>
										inConnection<font color="#990000">.</font>sourceAudioUnit<font color="#990000">,</font>
										kAudioUnitProperty_StreamFormat<font color="#990000">,</font>
										kAudioUnitScope_Output<font color="#990000">,</font>
										inConnection<font color="#990000">.</font>sourceOutputNumber<font color="#990000">,</font>
										<font color="#990000">&amp;</font>sourceDesc<font color="#990000">,</font>
										<font color="#990000">&amp;</font>size<font color="#990000">),</font> errexit<font color="#990000">);</font>
		<b><font color="#000000">ca_require_noerr</font></b><font color="#990000">(</font>err <font color="#990000">=</font> <b><font color="#000000">DispatchSetProperty</font></b> <font color="#990000">(</font>kAudioUnitProperty_StreamFormat<font color="#990000">,</font> 
								kAudioUnitScope_Input<font color="#990000">,</font> inConnection<font color="#990000">.</font>destInputNumber<font color="#990000">,</font> 
								<font color="#990000">&amp;</font>sourceDesc<font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>CAStreamBasicDescription<font color="#990000">)),</font> errexit<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	input<font color="#990000">-&gt;</font><b><font color="#000000">SetConnection</font></b><font color="#990000">(</font>inConnection<font color="#990000">);</font>
		
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>kAudioUnitProperty_MakeConnection<font color="#990000">,</font> kAudioUnitScope_Input<font color="#990000">,</font> inConnection<font color="#990000">.</font>destInputNumber<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>

<b><font color="#008080">errexit:</font></b>
	<b><font color="#0000FF">return</font></b> err<font color="#990000">;</font>
<font color="#FF0000">}</font>
 
<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">UInt32</font>				AUBase<font color="#990000">::</font><b><font color="#000000">SupportedNumChannels</font></b> <font color="#990000">(</font>	<b><font color="#0000FF">const</font></b> AUChannelInfo<font color="#990000">**</font> 			outInfo<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">bool</font>				AUBase<font color="#990000">::</font><b><font color="#000000">ValidFormat</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">,</font>
													<b><font color="#0000FF">const</font></b> CAStreamBasicDescription <font color="#990000">&amp;</font>		inNewFormat<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#000000">FormatIsCanonical</font></b><font color="#990000">(</font>inNewFormat<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">bool</font>				AUBase<font color="#990000">::</font><b><font color="#000000">IsStreamFormatWritable</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>					scope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				element<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>scope<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Input<font color="#990000">:</font>
		<font color="#FF0000">{</font>
			<font color="#008080">AUInputElement</font> <font color="#990000">*</font>input <font color="#990000">=</font> <b><font color="#000000">GetInput</font></b><font color="#990000">(</font>element<font color="#990000">);</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>input<font color="#990000">-&gt;</font><b><font color="#000000">HasConnection</font></b><font color="#990000">())</font> <b><font color="#0000FF">return</font></b> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>	<i><font color="#9A1900">// can't write format when input comes from connection</font></i>
		<font color="#FF0000">}</font>
		<i><font color="#9A1900">// ... fall ...</font></i>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Output<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#000000">StreamFormatWritable</font></b><font color="#990000">(</font>scope<font color="#990000">,</font> element<font color="#990000">);</font>

<i><font color="#9A1900">//#warning "aliasing of global scope format should be pushed to subclasses"</font></i>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Global<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#000000">StreamFormatWritable</font></b><font color="#990000">(</font>kAudioUnitScope_Output<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<b><font color="#0000FF">const</font></b> CAStreamBasicDescription <font color="#990000">&amp;</font>
					AUBase<font color="#990000">::</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
<i><font color="#9A1900">//#warning "aliasing of global scope format should be pushed to subclasses"</font></i>
	<font color="#008080">AUIOElement</font> <font color="#990000">*</font>element<font color="#990000">;</font>
	
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inScope<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Input<font color="#990000">:</font>
		element <font color="#990000">=</font> <b><font color="#000000">Inputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Output<font color="#990000">:</font>
		element <font color="#990000">=</font> <b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Global<font color="#990000">:</font>	<i><font color="#9A1900">// global stream description is an alias for that of output 0</font></i>
		element <font color="#990000">=</font> <b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#008080">	default:</font></b>
		<b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>kAudioUnitErr_InvalidScope<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> element<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">();</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SetBusCount</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
											<font color="#008080">UInt32</font> 							inCount<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">IsInitialized</font></b><font color="#990000">())</font> 
		<b><font color="#0000FF">return</font></b> kAudioUnitErr_Initialized<font color="#990000">;</font>
		
	<b><font color="#000000">GetScope</font></b><font color="#990000">(</font>inScope<font color="#990000">).</font><b><font color="#000000">SetNumberOfElements</font></b><font color="#990000">(</font>inCount<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">ChangeStreamFormat</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				inElement<font color="#990000">,</font>
													<b><font color="#0000FF">const</font></b> CAStreamBasicDescription <font color="#990000">&amp;</font> inPrevFormat<font color="#990000">,</font>
													<b><font color="#0000FF">const</font></b> CAStreamBasicDescription <font color="#990000">&amp;</font>	inNewFormat<font color="#990000">)</font>
<font color="#FF0000">{</font>
<i><font color="#9A1900">//#warning "aliasing of global scope format should be pushed to subclasses"</font></i>
	<font color="#008080">AUIOElement</font> <font color="#990000">*</font>element<font color="#990000">;</font>
	
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>inScope<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Input<font color="#990000">:</font>
		element <font color="#990000">=</font> <b><font color="#000000">Inputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Output<font color="#990000">:</font>
		element <font color="#990000">=</font> <b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inElement<font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Global<font color="#990000">:</font>
		element <font color="#990000">=</font> <b><font color="#000000">Outputs</font></b><font color="#990000">().</font><b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">);</font>
		<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
<b><font color="#008080">	default:</font></b>
		<b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>kAudioUnitErr_InvalidScope<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	element<font color="#990000">-&gt;</font><b><font color="#000000">SetStreamFormat</font></b><font color="#990000">(</font>inNewFormat<font color="#990000">);</font>
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>kAudioUnitProperty_StreamFormat<font color="#990000">,</font> inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">UInt32</font>		AUBase<font color="#990000">::</font><b><font color="#000000">GetChannelLayoutTags</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>				inScope<font color="#990000">,</font>
											<font color="#008080">AudioUnitElement</font> 			inElement<font color="#990000">,</font>
											AudioChannelLayoutTag <font color="#990000">*</font>		outLayoutTags<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">)-&gt;</font><b><font color="#000000">GetChannelLayoutTags</font></b><font color="#990000">(</font>outLayoutTags<font color="#990000">);</font>
<font color="#FF0000">}</font>

<font color="#008080">UInt32</font>		AUBase<font color="#990000">::</font><b><font color="#000000">GetAudioChannelLayout</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>				scope<font color="#990000">,</font>
											<font color="#008080">AudioUnitElement</font> 			element<font color="#990000">,</font>
											AudioChannelLayout <font color="#990000">*</font>		outLayoutPtr<font color="#990000">,</font>
											Boolean <font color="#990000">&amp;</font>					outWritable<font color="#990000">)</font>
<font color="#FF0000">{</font>
	AUIOElement <font color="#990000">*</font> el <font color="#990000">=</font> <b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>scope<font color="#990000">,</font> element<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> el<font color="#990000">-&gt;</font><b><font color="#000000">GetAudioChannelLayout</font></b><font color="#990000">(</font>outLayoutPtr<font color="#990000">,</font> outWritable<font color="#990000">);</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font>	AUBase<font color="#990000">::</font><b><font color="#000000">RemoveAudioChannelLayout</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitScope</font>				inScope<font color="#990000">,</font>
														<font color="#008080">AudioUnitElement</font>			inElement<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> noErr<font color="#990000">;</font>
	AUIOElement <font color="#990000">*</font> el <font color="#990000">=</font> <b><font color="#000000">GetIOElement</font></b><font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>
	<font color="#008080">Boolean</font> writable<font color="#990000">;</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>el<font color="#990000">-&gt;</font><b><font color="#000000">GetAudioChannelLayout</font></b><font color="#990000">(</font>NULL<font color="#990000">,</font> writable<font color="#990000">))</font> <font color="#FF0000">{</font>
		result <font color="#990000">=</font> el<font color="#990000">-&gt;</font><b><font color="#000000">RemoveAudioChannelLayout</font></b><font color="#990000">();</font>
	<font color="#FF0000">}</font>
	<b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font> 	AUBase<font color="#990000">::</font><b><font color="#000000">SetAudioChannelLayout</font></b><font color="#990000">(</font>				<font color="#008080">AudioUnitScope</font> 				inScope<font color="#990000">,</font> 
														<font color="#008080">AudioUnitElement</font> 			inElement<font color="#990000">,</font>
														<b><font color="#0000FF">const</font></b> AudioChannelLayout <font color="#990000">*</font>	inLayout<font color="#990000">)</font>
<font color="#FF0000">{</font>
	AUIOElement<font color="#990000">*</font> ioEl <font color="#990000">=</font> <b><font color="#000000">GetIOElement</font></b> <font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">);</font>

	<i><font color="#9A1900">// the num channels of the layout HAS TO MATCH the current channels of the Element's stream format</font></i>
	<font color="#008080">UInt32</font> currentChannels <font color="#990000">=</font> ioEl<font color="#990000">-&gt;</font><b><font color="#000000">GetStreamFormat</font></b><font color="#990000">().</font><b><font color="#000000">NumberChannels</font></b><font color="#990000">();</font>
	<font color="#008080">UInt32</font> numChannelsInLayout <font color="#990000">=</font> CAAudioChannelLayout<font color="#990000">::</font><b><font color="#000000">NumberChannels</font></b><font color="#990000">(*</font>inLayout<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>currentChannels <font color="#990000">!=</font> numChannelsInLayout<font color="#990000">)</font>
		<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>

	<font color="#008080">UInt32</font> numLayouts <font color="#990000">=</font> <b><font color="#000000">GetChannelLayoutTags</font></b> <font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> NULL<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>numLayouts <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font>
		<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
	<font color="#008080">AudioChannelLayoutTag</font> <font color="#990000">*</font>tags <font color="#990000">=</font> <font color="#990000">(</font>AudioChannelLayoutTag <font color="#990000">*)</font><b><font color="#000000">CA_malloc</font></b> <font color="#990000">(</font>numLayouts <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b> <font color="#990000">(</font>AudioChannelLayoutTag<font color="#990000">));</font>
	<b><font color="#000000">GetChannelLayoutTags</font></b> <font color="#990000">(</font>inScope<font color="#990000">,</font> inElement<font color="#990000">,</font> tags<font color="#990000">);</font>
	<font color="#009900">bool</font> foundTag <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">unsigned</font> <font color="#009900">int</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> numLayouts<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>tags<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">==</font> inLayout<font color="#990000">-&gt;</font>mChannelLayoutTag <font color="#990000">||</font> tags<font color="#990000">[</font>i<font color="#990000">]</font> <font color="#990000">==</font> kAudioChannelLayoutTag_UseChannelDescriptions<font color="#990000">)</font> <font color="#FF0000">{</font>
			foundTag <font color="#990000">=</font> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
			<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>
	<b><font color="#000000">free</font></b><font color="#990000">(</font>tags<font color="#990000">);</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>foundTag <font color="#990000">==</font> <b><font color="#0000FF">false</font></b><font color="#990000">)</font>
		<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>

	<b><font color="#0000FF">return</font></b> ioEl<font color="#990000">-&gt;</font><b><font color="#000000">SetAudioChannelLayout</font></b><font color="#990000">(*</font>inLayout<font color="#990000">);</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">static</font></b> <font color="#009900">void</font> <b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font><font color="#008080">CFMutableDictionaryRef</font> dict<font color="#990000">,</font> <font color="#008080">CFStringRef</font> key<font color="#990000">,</font> <font color="#008080">SInt32</font> value<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">CFNumberRef</font> num <font color="#990000">=</font> <b><font color="#000000">CFNumberCreate</font></b> <font color="#990000">(</font>NULL<font color="#990000">,</font> kCFNumberSInt32Type<font color="#990000">,</font> <font color="#990000">&amp;</font>value<font color="#990000">);</font>
	<b><font color="#000000">CFDictionarySetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> key<font color="#990000">,</font> num<font color="#990000">);</font>
	<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>num<font color="#990000">);</font>
<font color="#FF0000">}</font>

<b><font color="#000080">#define</font></b> kCurrentSavedStateVersion <font color="#993399">0</font>

<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">SaveState</font></b><font color="#990000">(</font>		CFPropertyListRef <font color="#990000">*</font> outData<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">AudioComponentDescription</font> desc <font color="#990000">=</font> <b><font color="#000000">GetComponentDescription</font></b><font color="#990000">();</font>

	<font color="#008080">CFMutableDictionaryRef</font> dict <font color="#990000">=</font> <b><font color="#000000">CFDictionaryCreateMutable</font></b>	<font color="#990000">(</font>NULL<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> 
								<font color="#990000">&amp;</font>kCFTypeDictionaryKeyCallBacks<font color="#990000">,</font> <font color="#990000">&amp;</font>kCFTypeDictionaryValueCallBacks<font color="#990000">);</font>

<i><font color="#9A1900">// first step -&gt; save the version to the data ref</font></i>
	<font color="#008080">SInt32</font> value <font color="#990000">=</font> kCurrentSavedStateVersion<font color="#990000">;</font>
	<b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kVersionString<font color="#990000">,</font> value<font color="#990000">);</font>

<i><font color="#9A1900">// second step -&gt; save the component type, subtype, manu to the data ref</font></i>
	value <font color="#990000">=</font> desc<font color="#990000">.</font>componentType<font color="#990000">;</font>
	<b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kTypeString<font color="#990000">,</font> value<font color="#990000">);</font>

	value <font color="#990000">=</font> desc<font color="#990000">.</font>componentSubType<font color="#990000">;</font>
	<b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kSubtypeString<font color="#990000">,</font> value<font color="#990000">);</font>
	
	value <font color="#990000">=</font> desc<font color="#990000">.</font>componentManufacturer<font color="#990000">;</font>
	<b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kManufacturerString<font color="#990000">,</font> value<font color="#990000">);</font>
	
<i><font color="#9A1900">// fourth step -&gt; save the state of all parameters on all scopes and elements</font></i>
	<font color="#008080">CFMutableDataRef</font> data <font color="#990000">=</font> <b><font color="#000000">CFDataCreateMutable</font></b><font color="#990000">(</font>NULL<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#008080">AudioUnitScope</font> iscope <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> iscope <font color="#990000">&lt;</font> <font color="#993399">3</font><font color="#990000">;</font> <font color="#990000">++</font>iscope<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">AUScope</font> <font color="#990000">&amp;</font>scope <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b><font color="#990000">(</font>iscope<font color="#990000">);</font>
		<font color="#008080">AudioUnitElement</font> nElems <font color="#990000">=</font> scope<font color="#990000">.</font><b><font color="#000000">GetNumberOfElements</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#008080">AudioUnitElement</font> ielem <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ielem <font color="#990000">&lt;</font> nElems<font color="#990000">;</font> <font color="#990000">++</font>ielem<font color="#990000">)</font> <font color="#FF0000">{</font>
			<font color="#008080">AUElement</font> <font color="#990000">*</font>element <font color="#990000">=</font> scope<font color="#990000">.</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>ielem<font color="#990000">);</font>
			<font color="#008080">UInt32</font> nparams <font color="#990000">=</font> element<font color="#990000">-&gt;</font><b><font color="#000000">GetNumberOfParameters</font></b><font color="#990000">();</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>nparams <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
				<b><font color="#0000FF">struct</font></b> <font color="#FF0000">{</font>
					<font color="#008080">UInt32</font>	scope<font color="#990000">;</font>
					<font color="#008080">UInt32</font>	element<font color="#990000">;</font>
				<font color="#FF0000">}</font> hdr<font color="#990000">;</font>
				
				hdr<font color="#990000">.</font>scope <font color="#990000">=</font> <b><font color="#000000">CFSwapInt32HostToBig</font></b><font color="#990000">(</font>iscope<font color="#990000">);</font>
				hdr<font color="#990000">.</font>element <font color="#990000">=</font> <b><font color="#000000">CFSwapInt32HostToBig</font></b><font color="#990000">(</font>ielem<font color="#990000">);</font>
				<b><font color="#000000">CFDataAppendBytes</font></b><font color="#990000">(</font>data<font color="#990000">,</font> <font color="#990000">(</font>UInt8 <font color="#990000">*)&amp;</font>hdr<font color="#990000">,</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>hdr<font color="#990000">));</font>
				
				element<font color="#990000">-&gt;</font><b><font color="#000000">SaveState</font></b><font color="#990000">(</font>data<font color="#990000">);</font>
			<font color="#FF0000">}</font>
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>

<i><font color="#9A1900">// save all this in the data section of the dictionary</font></i>
	<b><font color="#000000">CFDictionarySetValue</font></b><font color="#990000">(</font>dict<font color="#990000">,</font> kDataString<font color="#990000">,</font> data<font color="#990000">);</font>
	<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>data<font color="#990000">);</font>
	
<i><font color="#9A1900">//OK - now we're going to do some properties 	</font></i>
<i><font color="#9A1900">//save the preset name...</font></i>
	<b><font color="#000000">CFDictionarySetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kNameString<font color="#990000">,</font> mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>

<i><font color="#9A1900">// Does the unit support the RenderQuality property - if so, save it...</font></i>
	value <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
	<font color="#008080">OSStatus</font> result <font color="#990000">=</font> <b><font color="#000000">DispatchGetProperty</font></b> <font color="#990000">(</font>kAudioUnitProperty_RenderQuality<font color="#990000">,</font>
								kAudioUnitScope_Global<font color="#990000">,</font>
								<font color="#993399">0</font><font color="#990000">,</font>
								<font color="#990000">&amp;</font>value<font color="#990000">);</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font> <font color="#FF0000">{</font>
		<b><font color="#000000">AddNumToDictionary</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kRenderQualityString<font color="#990000">,</font> value<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	
<i><font color="#9A1900">// Does the unit support the CPULoad Quality property - if so, save it...</font></i>
	<font color="#008080">Float32</font> cpuLoad<font color="#990000">;</font>
	result <font color="#990000">=</font> <b><font color="#000000">DispatchGetProperty</font></b> <font color="#990000">(</font><font color="#993399">6</font><i><font color="#9A1900">/*kAudioUnitProperty_CPULoad*/</font></i><font color="#990000">,</font>
								kAudioUnitScope_Global<font color="#990000">,</font>
								<font color="#993399">0</font><font color="#990000">,</font>
								<font color="#990000">&amp;</font>cpuLoad<font color="#990000">);</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>result <font color="#990000">==</font> noErr<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">CFNumberRef</font> num <font color="#990000">=</font> <b><font color="#000000">CFNumberCreate</font></b> <font color="#990000">(</font>NULL<font color="#990000">,</font> kCFNumberFloatType<font color="#990000">,</font> <font color="#990000">&amp;</font>cpuLoad<font color="#990000">);</font>
		<b><font color="#000000">CFDictionarySetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kCPULoadString<font color="#990000">,</font> num<font color="#990000">);</font>
		<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>num<font color="#990000">);</font>
	<font color="#FF0000">}</font>

<i><font color="#9A1900">// Do we have any element names for any of our scopes?	</font></i>
	<i><font color="#9A1900">// first check to see if we have any names...</font></i>
	<font color="#009900">bool</font> foundName <font color="#990000">=</font> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#008080">AudioUnitScope</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> kNumScopes<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
		foundName <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b> <font color="#990000">(</font>i<font color="#990000">).</font><b><font color="#000000">HasElementWithName</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>foundName<font color="#990000">)</font> 
			<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
		<i><font color="#9A1900">// OK - we found a name away we go...</font></i>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>foundName<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">CFMutableDictionaryRef</font> nameDict <font color="#990000">=</font> <b><font color="#000000">CFDictionaryCreateMutable</font></b>	<font color="#990000">(</font>NULL<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">,</font> 
								<font color="#990000">&amp;</font>kCFTypeDictionaryKeyCallBacks<font color="#990000">,</font> <font color="#990000">&amp;</font>kCFTypeDictionaryValueCallBacks<font color="#990000">);</font>
		<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#008080">AudioUnitScope</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> kNumScopes<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#000000">GetScope</font></b> <font color="#990000">(</font>i<font color="#990000">).</font><b><font color="#000000">AddElementNamesToDict</font></b> <font color="#990000">(</font>nameDict<font color="#990000">);</font>
		<font color="#FF0000">}</font>
		
		<b><font color="#000000">CFDictionarySetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kElementNameString<font color="#990000">,</font> nameDict<font color="#990000">);</font>
		<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>nameDict<font color="#990000">);</font>
	<font color="#FF0000">}</font>
	
<i><font color="#9A1900">// we're done!!!</font></i>
	<font color="#990000">*</font>outData <font color="#990000">=</font> dict<font color="#990000">;</font>

	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">RestoreState</font></b><font color="#990000">(</font>	<font color="#008080">CFPropertyListRef</font>	plist<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFGetTypeID</font></b><font color="#990000">(</font>plist<font color="#990000">)</font> <font color="#990000">!=</font> <b><font color="#000000">CFDictionaryGetTypeID</font></b><font color="#990000">())</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
	
	<font color="#008080">AudioComponentDescription</font> desc <font color="#990000">=</font> <b><font color="#000000">GetComponentDescription</font></b><font color="#990000">();</font>
	
	<font color="#008080">CFDictionaryRef</font> dict <font color="#990000">=</font> <b><font color="#0000FF">static_cast</font></b><font color="#990000">&lt;</font>CFDictionaryRef<font color="#990000">&gt;(</font>plist<font color="#990000">);</font>

<i><font color="#9A1900">// zeroeth step - make sure the Part key is NOT present, as this method is used</font></i>
<i><font color="#9A1900">// to restore the GLOBAL state of the dictionary	</font></i>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFDictionaryContainsKey</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kPartString<font color="#990000">))</font>
		<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
		
<i><font color="#9A1900">// first step -&gt; check the saved version in the data ref</font></i>
<i><font color="#9A1900">// at this point we're only dealing with version==0</font></i>
	<font color="#008080">CFNumberRef</font> cfnum <font color="#990000">=</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font>CFNumberRef<font color="#990000">&gt;(</font><b><font color="#000000">CFDictionaryGetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kVersionString<font color="#990000">));</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>cfnum <font color="#990000">==</font> NULL<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
	<font color="#008080">SInt32</font> value<font color="#990000">;</font>
	<b><font color="#000000">CFNumberGetValue</font></b> <font color="#990000">(</font>cfnum<font color="#990000">,</font> kCFNumberSInt32Type<font color="#990000">,</font> <font color="#990000">&amp;</font>value<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">!=</font> kCurrentSavedStateVersion<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>

<i><font color="#9A1900">// second step -&gt; check that this data belongs to this kind of audio unit</font></i>
<i><font color="#9A1900">// by checking the component subtype and manuID</font></i>
<i><font color="#9A1900">// We're not checking the type, since there may be different versions (effect, format-converter, offline)</font></i>
<i><font color="#9A1900">// of essentially the same AU</font></i>
	cfnum <font color="#990000">=</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font>CFNumberRef<font color="#990000">&gt;(</font><b><font color="#000000">CFDictionaryGetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kSubtypeString<font color="#990000">));</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>cfnum <font color="#990000">==</font> NULL<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
	<b><font color="#000000">CFNumberGetValue</font></b> <font color="#990000">(</font>cfnum<font color="#990000">,</font> kCFNumberSInt32Type<font color="#990000">,</font> <font color="#990000">&amp;</font>value<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">UInt32</font></b><font color="#990000">(</font>value<font color="#990000">)</font> <font color="#990000">!=</font> desc<font color="#990000">.</font>componentSubType<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>

	cfnum <font color="#990000">=</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font>CFNumberRef<font color="#990000">&gt;(</font><b><font color="#000000">CFDictionaryGetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kManufacturerString<font color="#990000">));</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>cfnum <font color="#990000">==</font> NULL<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>
	<b><font color="#000000">CFNumberGetValue</font></b> <font color="#990000">(</font>cfnum<font color="#990000">,</font> kCFNumberSInt32Type<font color="#990000">,</font> <font color="#990000">&amp;</font>value<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">UInt32</font></b><font color="#990000">(</font>value<font color="#990000">)</font> <font color="#990000">!=</font> desc<font color="#990000">.</font>componentManufacturer<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidPropertyValue<font color="#990000">;</font>

<i><font color="#9A1900">// fourth step -&gt; restore the state of all of the parameters for each scope and element	</font></i>
	<font color="#008080">CFDataRef</font> data <font color="#990000">=</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font>CFDataRef<font color="#990000">&gt;(</font><b><font color="#000000">CFDictionaryGetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kDataString<font color="#990000">));</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>data <font color="#990000">!=</font> NULL<font color="#990000">)</font> 
	<font color="#FF0000">{</font>
		<b><font color="#0000FF">const</font></b> <font color="#008080">UInt8</font> <font color="#990000">*</font>p<font color="#990000">,</font> <font color="#990000">*</font>pend<font color="#990000">;</font>
		
		p <font color="#990000">=</font> <b><font color="#000000">CFDataGetBytePtr</font></b><font color="#990000">(</font>data<font color="#990000">);</font>
		pend <font color="#990000">=</font> p <font color="#990000">+</font> <b><font color="#000000">CFDataGetLength</font></b><font color="#990000">(</font>data<font color="#990000">);</font>
		
		<i><font color="#9A1900">// we have a zero length data, which may just mean there were no parameters to save!</font></i>
		<i><font color="#9A1900">//	if (p &gt;= pend) return noErr; </font></i>
	
		<b><font color="#0000FF">while</font></b> <font color="#990000">(</font>p <font color="#990000">&lt;</font> pend<font color="#990000">)</font> <font color="#FF0000">{</font>
			<b><font color="#0000FF">struct</font></b> <font color="#FF0000">{</font>
				<font color="#008080">UInt32</font>	scope<font color="#990000">;</font>
				<font color="#008080">UInt32</font>	element<font color="#990000">;</font>
			<font color="#FF0000">}</font> hdr<font color="#990000">;</font>
			
			hdr<font color="#990000">.</font>scope <font color="#990000">=</font> <b><font color="#000000">CFSwapInt32BigToHost</font></b><font color="#990000">(*(</font>UInt32 <font color="#990000">*)</font>p<font color="#990000">);</font>		p <font color="#990000">+=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">);</font>
			hdr<font color="#990000">.</font>element <font color="#990000">=</font> <b><font color="#000000">CFSwapInt32BigToHost</font></b><font color="#990000">(*(</font>UInt32 <font color="#990000">*)</font>p<font color="#990000">);</font>	p <font color="#990000">+=</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>UInt32<font color="#990000">);</font>
			
			<font color="#008080">AUScope</font> <font color="#990000">&amp;</font>scope <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b><font color="#990000">(</font>hdr<font color="#990000">.</font>scope<font color="#990000">);</font>
			<font color="#008080">AUElement</font> <font color="#990000">*</font>element <font color="#990000">=</font> scope<font color="#990000">.</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>hdr<font color="#990000">.</font>element<font color="#990000">);</font>
				<i><font color="#9A1900">// $$$ order of operations issue: what if the element does not yet exist?</font></i>
				<i><font color="#9A1900">// then we just break out of the loop</font></i>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(!</font>element<font color="#990000">)</font>
				<b><font color="#0000FF">break</font></b><font color="#990000">;</font>
			p <font color="#990000">=</font> element<font color="#990000">-&gt;</font><b><font color="#000000">RestoreState</font></b><font color="#990000">(</font>p<font color="#990000">);</font>
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>

<i><font color="#9A1900">//OK - now we're going to do some properties 	</font></i>
<i><font color="#9A1900">//restore the preset name...</font></i>
	<font color="#008080">CFStringRef</font> name <font color="#990000">=</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font>CFStringRef<font color="#990000">&gt;(</font><b><font color="#000000">CFDictionaryGetValue</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kNameString<font color="#990000">));</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">)</font> <b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>name<font color="#990000">)</font>
	<font color="#FF0000">{</font>
		mCurrentPreset<font color="#990000">.</font>presetName <font color="#990000">=</font> name<font color="#990000">;</font>
		mCurrentPreset<font color="#990000">.</font>presetNumber <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
	<font color="#FF0000">}</font> 
	<b><font color="#0000FF">else</font></b> <font color="#FF0000">{</font> <i><font color="#9A1900">// no name entry make the default one</font></i>
		mCurrentPreset<font color="#990000">.</font>presetName <font color="#990000">=</font> kUntitledString<font color="#990000">;</font>
		mCurrentPreset<font color="#990000">.</font>presetNumber <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">;</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<b><font color="#000080">#ifndef</font></b> __LP64__
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>kAudioUnitProperty_CurrentPreset<font color="#990000">,</font> kAudioUnitScope_Global<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
<b><font color="#000080">#endif</font></b>
<b><font color="#000080">#endif</font></b>
	<b><font color="#000000">PropertyChanged</font></b><font color="#990000">(</font>kAudioUnitProperty_PresentPreset<font color="#990000">,</font> kAudioUnitScope_Global<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>

<i><font color="#9A1900">// Does the dict contain render quality information?		</font></i>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFDictionaryGetValueIfPresent</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kRenderQualityString<font color="#990000">,</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">const</font></b> <font color="#009900">void</font><font color="#990000">**&gt;(&amp;</font>cfnum<font color="#990000">)))</font> 
	<font color="#FF0000">{</font>
		<b><font color="#000000">CFNumberGetValue</font></b> <font color="#990000">(</font>cfnum<font color="#990000">,</font> kCFNumberSInt32Type<font color="#990000">,</font> <font color="#990000">&amp;</font>value<font color="#990000">);</font>
		<b><font color="#000000">DispatchSetProperty</font></b> <font color="#990000">(</font>kAudioUnitProperty_RenderQuality<font color="#990000">,</font>
								kAudioUnitScope_Global<font color="#990000">,</font>
								<font color="#993399">0</font><font color="#990000">,</font>
								<font color="#990000">&amp;</font>value<font color="#990000">,</font>
								<b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>value<font color="#990000">));</font>
	<font color="#FF0000">}</font>
	
<i><font color="#9A1900">// Does the unit support the CPULoad Quality property - if so, save it...</font></i>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFDictionaryGetValueIfPresent</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kCPULoadString<font color="#990000">,</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">const</font></b> <font color="#009900">void</font><font color="#990000">**&gt;(&amp;</font>cfnum<font color="#990000">)))</font> 
	<font color="#FF0000">{</font>
		<font color="#008080">Float32</font> floatValue<font color="#990000">;</font>
		<b><font color="#000000">CFNumberGetValue</font></b> <font color="#990000">(</font>cfnum<font color="#990000">,</font> kCFNumberFloatType<font color="#990000">,</font> <font color="#990000">&amp;</font>floatValue<font color="#990000">);</font>
		<b><font color="#000000">DispatchSetProperty</font></b> <font color="#990000">(</font><font color="#993399">6</font><i><font color="#9A1900">/*kAudioUnitProperty_CPULoad*/</font></i><font color="#990000">,</font>
								kAudioUnitScope_Global<font color="#990000">,</font>
								<font color="#993399">0</font><font color="#990000">,</font>
								<font color="#990000">&amp;</font>floatValue<font color="#990000">,</font>
								<b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>floatValue<font color="#990000">));</font>
	<font color="#FF0000">}</font>

<i><font color="#9A1900">// Do we have any element names for any of our scopes?</font></i>
	<font color="#008080">CFDictionaryRef</font> nameDict<font color="#990000">;</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFDictionaryGetValueIfPresent</font></b> <font color="#990000">(</font>dict<font color="#990000">,</font> kElementNameString<font color="#990000">,</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">const</font></b> <font color="#009900">void</font><font color="#990000">**&gt;(&amp;</font>nameDict<font color="#990000">)))</font> 
	<font color="#FF0000">{</font>
		<font color="#009900">char</font> string<font color="#990000">[</font><font color="#993399">64</font><font color="#990000">];</font>
		<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">int</font> i <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> i <font color="#990000">&lt;</font> kNumScopes<font color="#990000">;</font> <font color="#990000">++</font>i<font color="#990000">)</font> 
		<font color="#FF0000">{</font>
			<b><font color="#000000">sprintf</font></b> <font color="#990000">(</font>string<font color="#990000">,</font> <font color="#FF0000">"%d"</font><font color="#990000">,</font> i<font color="#990000">);</font>
			<font color="#008080">CFStringRef</font> key <font color="#990000">=</font> <b><font color="#000000">CFStringCreateWithCString</font></b> <font color="#990000">(</font>NULL<font color="#990000">,</font> string<font color="#990000">,</font> kCFStringEncodingASCII<font color="#990000">);</font>
			<font color="#008080">CFDictionaryRef</font> elementDict<font color="#990000">;</font>
			<b><font color="#0000FF">if</font></b> <font color="#990000">(</font><b><font color="#000000">CFDictionaryGetValueIfPresent</font></b> <font color="#990000">(</font>nameDict<font color="#990000">,</font> key<font color="#990000">,</font> <b><font color="#0000FF">reinterpret_cast</font></b><font color="#990000">&lt;</font><b><font color="#0000FF">const</font></b> <font color="#009900">void</font><font color="#990000">**&gt;(&amp;</font>elementDict<font color="#990000">)))</font> 
			<font color="#FF0000">{</font>
				<font color="#009900">bool</font> didAddElements <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b> <font color="#990000">(</font>i<font color="#990000">).</font><b><font color="#000000">RestoreElementNames</font></b> <font color="#990000">(</font>elementDict<font color="#990000">);</font>
				<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>didAddElements<font color="#990000">)</font>
					<b><font color="#000000">PropertyChanged</font></b> <font color="#990000">(</font>kAudioUnitProperty_ElementCount<font color="#990000">,</font> i<font color="#990000">,</font> <font color="#993399">0</font><font color="#990000">);</font>
			<font color="#FF0000">}</font>
			<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>key<font color="#990000">);</font>				
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetPresets</font></b> <font color="#990000">(</font>			CFArrayRef <font color="#990000">*</font> 					outData<font color="#990000">)</font> <b><font color="#0000FF">const</font></b>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">NewFactoryPresetSet</font></b> <font color="#990000">(</font><b><font color="#0000FF">const</font></b> AUPreset <font color="#990000">&amp;</font> inNewFactoryPreset<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>

		<i><font color="#9A1900">// set the default preset for the unit -&gt; the number of the preset MUST be &gt;= 0</font></i>
		<i><font color="#9A1900">// and the name should be valid, or the preset WON'T take</font></i>
<font color="#009900">bool</font>				AUBase<font color="#990000">::</font><b><font color="#000000">SetAFactoryPresetAsCurrent</font></b> <font color="#990000">(</font><b><font color="#0000FF">const</font></b> AUPreset <font color="#990000">&amp;</font> inPreset<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inPreset<font color="#990000">.</font>presetNumber <font color="#990000">&lt;</font> <font color="#993399">0</font> <font color="#990000">||</font> inPreset<font color="#990000">.</font>presetName <font color="#990000">==</font> NULL<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
	<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
	mCurrentPreset <font color="#990000">=</font> inPreset<font color="#990000">;</font>
	<b><font color="#000000">CFRetain</font></b> <font color="#990000">(</font>mCurrentPreset<font color="#990000">.</font>presetName<font color="#990000">);</font>
	<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_USE_AUDIO_PLUGIN_ONLY
<font color="#009900">int</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetNumCustomUIComponents</font></b> <font color="#990000">()</font> 
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#009900">void</font>		AUBase<font color="#990000">::</font><b><font color="#000000">GetUIComponentDescs</font></b> <font color="#990000">(</font>ComponentDescription<font color="#990000">*</font> inDescArray<font color="#990000">)</font> <font color="#FF0000">{}</font>
<b><font color="#000080">#endif</font></b>
	
<font color="#009900">bool</font>		AUBase<font color="#990000">::</font><b><font color="#000000">HasIcon</font></b> <font color="#990000">()</font> 
<font color="#FF0000">{</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_NO_AU_UI_FEATURES
	<font color="#008080">CFURLRef</font> url <font color="#990000">=</font> <b><font color="#000000">CopyIconLocation</font></b><font color="#990000">();</font> 
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>url<font color="#990000">)</font> <font color="#FF0000">{</font>
		<b><font color="#000000">CFRelease</font></b> <font color="#990000">(</font>url<font color="#990000">);</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">true</font></b><font color="#990000">;</font>
	<font color="#FF0000">}</font>
<b><font color="#000080">#endif</font></b>
	<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">false</font></b><font color="#990000">;</font>
<font color="#FF0000">}</font>

<font color="#008080">CFURLRef</font>	AUBase<font color="#990000">::</font><b><font color="#000000">CopyIconLocation</font></b> <font color="#990000">()</font> 
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> NULL<font color="#990000">;</font>
<font color="#FF0000">}</font>
	
<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetParameterList</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													AudioUnitParameterID <font color="#990000">*</font>			outParameterList<font color="#990000">,</font>
													UInt32 <font color="#990000">&amp;</font>						outNumParameters<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<font color="#008080">AUScope</font> <font color="#990000">&amp;</font>scope <font color="#990000">=</font> <b><font color="#000000">GetScope</font></b><font color="#990000">(</font>inScope<font color="#990000">);</font>
	<font color="#008080">AUElement</font> <font color="#990000">*</font>elementWithMostParameters <font color="#990000">=</font> NULL<font color="#990000">;</font>
	<font color="#008080">UInt32</font> maxNumParams <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
	
	<font color="#009900">int</font> nElems <font color="#990000">=</font> scope<font color="#990000">.</font><b><font color="#000000">GetNumberOfElements</font></b><font color="#990000">();</font>
	<b><font color="#0000FF">for</font></b> <font color="#990000">(</font><font color="#009900">int</font> ielem <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font> ielem <font color="#990000">&lt;</font> nElems<font color="#990000">;</font> <font color="#990000">++</font>ielem<font color="#990000">)</font> <font color="#FF0000">{</font>
		<font color="#008080">AUElement</font> <font color="#990000">*</font>element <font color="#990000">=</font> scope<font color="#990000">.</font><b><font color="#000000">GetElement</font></b><font color="#990000">(</font>ielem<font color="#990000">);</font>
		<font color="#008080">UInt32</font> nParams <font color="#990000">=</font> element<font color="#990000">-&gt;</font><b><font color="#000000">GetNumberOfParameters</font></b><font color="#990000">();</font>
		<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>nParams <font color="#990000">&gt;</font> maxNumParams<font color="#990000">)</font> <font color="#FF0000">{</font>
			maxNumParams <font color="#990000">=</font> nParams<font color="#990000">;</font>
			elementWithMostParameters <font color="#990000">=</font> element<font color="#990000">;</font>
		<font color="#FF0000">}</font>
	<font color="#FF0000">}</font>
	
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>outParameterList <font color="#990000">!=</font> NULL <font color="#990000">&amp;&amp;</font> elementWithMostParameters <font color="#990000">!=</font> NULL<font color="#990000">)</font>
		elementWithMostParameters<font color="#990000">-&gt;</font><b><font color="#000000">GetParameterList</font></b><font color="#990000">(</font>outParameterList<font color="#990000">);</font>
	
	outNumParameters <font color="#990000">=</font> maxNumParams<font color="#990000">;</font>
	<b><font color="#0000FF">return</font></b> noErr<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetParameterInfo</font></b><font color="#990000">(</font>		<font color="#008080">AudioUnitScope</font>			inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitParameterID</font>	inParameterID<font color="#990000">,</font>
													<font color="#008080">AudioUnitParameterInfo</font>	<font color="#990000">&amp;</font>outParameterInfo <font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidParameter<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetParameterValueStrings</font></b><font color="#990000">(</font><font color="#008080">AudioUnitScope</font>			inScope<font color="#990000">,</font>
													<font color="#008080">AudioUnitParameterID</font>	inParameterID<font color="#990000">,</font>
													CFArrayRef <font color="#990000">*</font>			outStrings<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">GetParameterHistoryInfo</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
														<font color="#008080">AudioUnitParameterID</font>			inParameterID<font color="#990000">,</font>
														Float32 <font color="#990000">&amp;</font>						outUpdatesPerSecond<font color="#990000">,</font>
														Float32 <font color="#990000">&amp;</font>						outHistoryDurationInSeconds<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>


<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#008080">OSStatus</font>			AUBase<font color="#990000">::</font><b><font color="#000000">CopyClumpName</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitScope</font>			inScope<font color="#990000">,</font> 
													<font color="#008080">UInt32</font>					inClumpID<font color="#990000">,</font> 
													<font color="#008080">UInt32</font>					inDesiredNameLength<font color="#990000">,</font>
													CFStringRef <font color="#990000">*</font>			outClumpName<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> kAudioUnitErr_InvalidProperty<font color="#990000">;</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>				AUBase<font color="#990000">::</font><b><font color="#000000">SetNumberOfElements</font></b><font color="#990000">(</font>	<font color="#008080">AudioUnitScope</font>					inScope<font color="#990000">,</font>
													<font color="#008080">UInt32</font>							numElements<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>inScope <font color="#990000">==</font> kAudioUnitScope_Global <font color="#990000">&amp;&amp;</font> numElements <font color="#990000">!=</font> <font color="#993399">1</font><font color="#990000">)</font>
		<b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>kAudioUnitErr_InvalidScope<font color="#990000">);</font>

	<b><font color="#000000">GetScope</font></b><font color="#990000">(</font>inScope<font color="#990000">).</font><b><font color="#000000">SetNumberOfElements</font></b><font color="#990000">(</font>numElements<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
AUElement <font color="#990000">*</font>			AUBase<font color="#990000">::</font><b><font color="#000000">CreateElement</font></b><font color="#990000">(</font>			<font color="#008080">AudioUnitScope</font>					scope<font color="#990000">,</font>
													<font color="#008080">AudioUnitElement</font>				element<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">switch</font></b> <font color="#990000">(</font>scope<font color="#990000">)</font> <font color="#FF0000">{</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Global<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b> <b><font color="#000000">AUElement</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">);</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Input<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b> <b><font color="#000000">AUInputElement</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">);</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Output<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b> <b><font color="#000000">AUOutputElement</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">);</font>
<b><font color="#000080">#if</font></b> <font color="#990000">!</font>CA_BASIC_AU_FEATURES
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Group<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b> <b><font color="#000000">AUElement</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">);</font>
	<b><font color="#0000FF">case</font></b> kAudioUnitScope_Part<font color="#990000">:</font>
		<b><font color="#0000FF">return</font></b> <b><font color="#0000FF">new</font></b> <b><font color="#000000">AUElement</font></b><font color="#990000">(</font><b><font color="#0000FF">this</font></b><font color="#990000">);</font>
<b><font color="#000080">#endif</font></b>
	<font color="#FF0000">}</font>
	<b><font color="#000000">COMPONENT_THROW</font></b><font color="#990000">(</font>kAudioUnitErr_InvalidScope<font color="#990000">);</font>
	
	<b><font color="#0000FF">return</font></b> NULL<font color="#990000">;</font>	<i><font color="#9A1900">// get rid of compiler warning</font></i>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">bool</font>	AUBase<font color="#990000">::</font><b><font color="#000000">FormatIsCanonical</font></b><font color="#990000">(</font>		<b><font color="#0000FF">const</font></b> <font color="#008080">CAStreamBasicDescription</font> <font color="#990000">&amp;</font>f<font color="#990000">)</font>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">return</font></b> <font color="#990000">(</font>f<font color="#990000">.</font>mFormatID <font color="#990000">==</font> kAudioFormatLinearPCM
		<font color="#990000">&amp;&amp;</font>	f<font color="#990000">.</font>mFramesPerPacket <font color="#990000">==</font> <font color="#993399">1</font>
		<font color="#990000">&amp;&amp;</font>	f<font color="#990000">.</font>mBytesPerPacket <font color="#990000">==</font> f<font color="#990000">.</font>mBytesPerFrame
<i><font color="#9A1900">//		&amp;&amp;	f.mChannelsPerFrame &gt;= 0	-- this is always true since it's unsigned</font></i>
		<i><font color="#9A1900">// so far, it's a valid PCM format</font></i>
<b><font color="#000080">#if</font></b> CA_PREFER_FIXED_POINT
		<font color="#990000">&amp;&amp;</font>	<font color="#990000">(</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kLinearPCMFormatFlagIsFloat<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">0</font>
		<font color="#990000">&amp;&amp;</font>	<font color="#990000">(((</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kLinearPCMFormatFlagsSampleFractionMask<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> kLinearPCMFormatFlagsSampleFractionShift<font color="#990000">)</font> <font color="#990000">==</font> kAudioUnitSampleFractionBits<font color="#990000">)</font>
<b><font color="#000080">#else</font></b>
		<font color="#990000">&amp;&amp;</font>	<font color="#990000">(</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kLinearPCMFormatFlagIsFloat<font color="#990000">)</font> <font color="#990000">!=</font> <font color="#993399">0</font>
<b><font color="#000080">#endif</font></b>
        <font color="#990000">&amp;&amp;</font>	<font color="#990000">((</font>f<font color="#990000">.</font>mChannelsPerFrame <font color="#990000">==</font> <font color="#993399">1</font><font color="#990000">)</font> <font color="#990000">||</font> <font color="#990000">((</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kAudioFormatFlagIsNonInterleaved<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#990000">==</font> <font color="#990000">(</font>mAudioUnitAPIVersion <font color="#990000">==</font> <font color="#993399">1</font><font color="#990000">))</font>
<b><font color="#000080">#if</font></b> TARGET_RT_BIG_ENDIAN
		<font color="#990000">&amp;&amp;</font>	<font color="#990000">(</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kLinearPCMFormatFlagIsBigEndian<font color="#990000">)</font> <font color="#990000">!=</font> <font color="#993399">0</font>
<b><font color="#000080">#else</font></b>
		<font color="#990000">&amp;&amp;</font>	<font color="#990000">(</font>f<font color="#990000">.</font>mFormatFlags <font color="#990000">&amp;</font> kLinearPCMFormatFlagIsBigEndian<font color="#990000">)</font> <font color="#990000">==</font> <font color="#993399">0</font>
<b><font color="#000080">#endif</font></b>
		<font color="#990000">&amp;&amp;</font>	f<font color="#990000">.</font>mBitsPerChannel <font color="#990000">==</font> <font color="#993399">8</font> <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitSampleType<font color="#990000">)</font>
		<font color="#990000">&amp;&amp;</font>	f<font color="#990000">.</font>mBytesPerFrame <font color="#990000">==</font> f<font color="#990000">.</font><b><font color="#000000">NumberInterleavedChannels</font></b><font color="#990000">()</font> <font color="#990000">*</font> <b><font color="#0000FF">sizeof</font></b><font color="#990000">(</font>AudioUnitSampleType<font color="#990000">)</font>
		<font color="#990000">);</font>
<font color="#FF0000">}</font>

<i><font color="#9A1900">//_____________________________________________________________________________</font></i>
<i><font color="#9A1900">//</font></i>
<font color="#009900">void</font>	AUBase<font color="#990000">::</font><b><font color="#000000">MakeCanonicalFormat</font></b><font color="#990000">(</font>	CAStreamBasicDescription <font color="#990000">&amp;</font>		f<font color="#990000">,</font>
										<font color="#009900">int</font>								nChannels<font color="#990000">)</font>
<font color="#FF0000">{</font>
	f<font color="#990000">.</font><b><font color="#000000">SetAUCanonical</font></b><font color="#990000">(</font>nChannels<font color="#990000">,</font> mAudioUnitAPIVersion <font color="#990000">&lt;</font> <font color="#993399">2</font><font color="#990000">);</font>	<i><font color="#9A1900">// interleaved for v1, non for v2</font></i>
	f<font color="#990000">.</font>mSampleRate <font color="#990000">=</font> <font color="#993399">0.0</font><font color="#990000">;</font>
<font color="#FF0000">}</font>

<b><font color="#0000FF">const</font></b> <font color="#008080">Float64</font> AUBase<font color="#990000">::</font>kNoLastRenderedSampleTime <font color="#990000">=</font> <font color="#990000">-</font><font color="#993399">1</font><font color="#990000">.;</font>

<b><font color="#000080">#include</font></b> <font color="#FF0000">"AUBaseHelper.h"</font>

<font color="#009900">char</font><font color="#990000">*</font>	AUBase<font color="#990000">::</font><b><font color="#000000">GetLoggingString</font></b> <font color="#990000">()</font> <b><font color="#0000FF">const</font></b>
<font color="#FF0000">{</font>
	<b><font color="#0000FF">if</font></b> <font color="#990000">(</font>mLogString<font color="#990000">)</font> <b><font color="#0000FF">return</font></b> mLogString<font color="#990000">;</font>
	
	<font color="#008080">AudioComponentDescription</font> desc <font color="#990000">=</font> <b><font color="#000000">GetComponentDescription</font></b><font color="#990000">();</font>
	
	<b><font color="#0000FF">const_cast</font></b><font color="#990000">&lt;</font>AUBase<font color="#990000">*&gt;(</font><b><font color="#0000FF">this</font></b><font color="#990000">)-&gt;</font>mLogString <font color="#990000">=</font> <b><font color="#0000FF">new</font></b> <font color="#009900">char</font><font color="#990000">[</font><font color="#993399">256</font><font color="#990000">];</font>
	<font color="#009900">char</font> str<font color="#990000">[</font><font color="#993399">24</font><font color="#990000">];</font>
	<font color="#009900">char</font> str1<font color="#990000">[</font><font color="#993399">24</font><font color="#990000">];</font>
	<font color="#009900">char</font> str2<font color="#990000">[</font><font color="#993399">24</font><font color="#990000">];</font>
	<b><font color="#000000">sprintf</font></b> <font color="#990000">(</font><b><font color="#0000FF">const_cast</font></b><font color="#990000">&lt;</font>AUBase<font color="#990000">*&gt;(</font><b><font color="#0000FF">this</font></b><font color="#990000">)-&gt;</font>mLogString<font color="#990000">,</font> <font color="#FF0000">"AU (%p): %s %s %s"</font><font color="#990000">,</font>
		<b><font color="#000000">GetComponentInstance</font></b><font color="#990000">(),</font>
		<b><font color="#000000">CAStringForOSType</font></b><font color="#990000">(</font>desc<font color="#990000">.</font>componentType<font color="#990000">,</font> str<font color="#990000">),</font>
		<b><font color="#000000">CAStringForOSType</font></b><font color="#990000">(</font>desc<font color="#990000">.</font>componentSubType<font color="#990000">,</font> str1<font color="#990000">),</font>
		<b><font color="#000000">CAStringForOSType</font></b><font color="#990000">(</font>desc<font color="#990000">.</font>componentManufacturer<font color="#990000">,</font> str2<font color="#990000">));</font>

	<b><font color="#0000FF">return</font></b> mLogString<font color="#990000">;</font>
<font color="#FF0000">}</font>

</tt></pre>
